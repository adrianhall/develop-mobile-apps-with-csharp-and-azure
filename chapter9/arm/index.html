
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter9/arm/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>Repeatable Deployments - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#repeatable-deployments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Repeatable Deployments
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Chapter 1 - Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 1 - Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Chapter 1 - Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_pc/" class="md-nav__link">
        Your First App - PC Edition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_mac/" class="md-nav__link">
        Your First App - Mac Edition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Chapter 2 - Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 2 - Authentication" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapter 2 - Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/backend/" class="md-nav__link">
        Authentication in the Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/enterprise/" class="md-nav__link">
        Enterprise Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/social/" class="md-nav__link">
        Social Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/debugging/" class="md-nav__link">
        Debugging Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/custom/" class="md-nav__link">
        Custom Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authorization/" class="md-nav__link">
        Claims and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/realworld/" class="md-nav__link">
        Tokens in Real Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/bestpractices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Chapter 3 - Data Access and Offline Sync
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 3 - Data Access and Offline Sync" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Chapter 3 - Data Access and Offline Sync
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/dataconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/server/" class="md-nav__link">
        Implementing Table Controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/projection/" class="md-nav__link">
        Data Projection and Queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/client/" class="md-nav__link">
        The Mobile Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/relationships/" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/domainmgr/" class="md-nav__link">
        The Domain Manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Chapter 4 - Server Side Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 4 - Server Side Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Chapter 4 - Server Side Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/options/" class="md-nav__link">
        Options for Server Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/custom/" class="md-nav__link">
        Custom HTTP Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/webjobs/" class="md-nav__link">
        WebJobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Chapter 5 - Push Notifications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 5 - Push Notifications" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Chapter 5 - Push Notifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/android/" class="md-nav__link">
        Android Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/ios/" class="md-nav__link">
        iOS Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/windows/" class="md-nav__link">
        Windows Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/recipes/" class="md-nav__link">
        Push Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Chapter 6 - Combining Web and Mobile Apps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 6 - Combining Web and Mobile Apps" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Chapter 6 - Combining Web and Mobile Apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/mvc/" class="md-nav__link">
        MVC Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/jquery/" class="md-nav__link">
        jQuery Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/angular/" class="md-nav__link">
        Angular Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/react/" class="md-nav__link">
        React Applications
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Chapter 7 - Other Useful Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 7 - Other Useful Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Chapter 7 - Other Useful Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/services/" class="md-nav__link">
        Useful Azure Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/search/" class="md-nav__link">
        Azure Search
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/media/" class="md-nav__link">
        Media Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Chapter 8 - Developing An App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 8 - Developing An App" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Chapter 8 - Developing An App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/developing/" class="md-nav__link">
        The Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/testing/" class="md-nav__link">
        Testing your Application
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Chapter 9 - Going to Production
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 9 - Going to Production" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Chapter 9 - Going to Production
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Repeatable Deployments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Repeatable Deployments
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#options-for-deployment" class="md-nav__link">
    Options for Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-arm-template" class="md-nav__link">
    Creating an ARM Template
  </a>
  
    <nav class="md-nav" aria-label="Creating an ARM Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters-and-variables" class="md-nav__link">
    Parameters and Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-sql-database" class="md-nav__link">
    The SQL Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-azure-app-service-plan" class="md-nav__link">
    The Azure App Service Plan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-azure-app-service" class="md-nav__link">
    The Azure App Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-an-arm-template-on-windows" class="md-nav__link">
    Deploying an ARM Template on Windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-an-arm-template-on-macos" class="md-nav__link">
    Deploying an ARM Template on MacOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-arm-template" class="md-nav__link">
    Creating the ARM Template
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../appsvc/" class="md-nav__link">
        Safe Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        Monitoring and Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../xamarin_tips/" class="md-nav__link">
        Xamarin Forms Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../android_appendix/" class="md-nav__link">
        Android Developer Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vs_extensions/" class="md-nav__link">
        Visual Studio Extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#options-for-deployment" class="md-nav__link">
    Options for Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-arm-template" class="md-nav__link">
    Creating an ARM Template
  </a>
  
    <nav class="md-nav" aria-label="Creating an ARM Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters-and-variables" class="md-nav__link">
    Parameters and Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    Resources
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-sql-database" class="md-nav__link">
    The SQL Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-azure-app-service-plan" class="md-nav__link">
    The Azure App Service Plan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-azure-app-service" class="md-nav__link">
    The Azure App Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-an-arm-template-on-windows" class="md-nav__link">
    Deploying an ARM Template on Windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-an-arm-template-on-macos" class="md-nav__link">
    Deploying an ARM Template on MacOS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-arm-template" class="md-nav__link">
    Creating the ARM Template
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter9/arm.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="repeatable-deployments">Repeatable Deployments<a class="headerlink" href="#repeatable-deployments" title="Permanent link">&para;</a></h1>
<p>You've finally got to the point where you want to release your app to the general public.  Congratulations!  I'm not going to cover releasing to the App Store in this section.  Each App Store has their own rules and requirements for apps and they change all the time.  You will need to follow their instructions.  If you haven't already, make sure you have a paid developer account for this activity.</p>
<p>That doesn't mean that you can't deal with the backend.  Now that your app is in production, you want your backend in production as well.  That means being as hands-off as possible and ensuring that human error does not cause a significant downtime.  We've heard about various outages as a result of human error.  Make sure that doesn't happen to you.  Fortunately, Azure has a number of facilities to ensure that you can automate the process.</p>
<h2 id="options-for-deployment">Options for Deployment<a class="headerlink" href="#options-for-deployment" title="Permanent link">&para;</a></h2>
<p>When deploying the backend, you want a repeatable process.  Ideally, you want a set of scripts that you check into source code that describes the deployment of Azure resources.  Once you have set up your environment, you can use continuous deployment (in the next section) to actually perform the deployments.  However, you still want to automate the deployment of a new set of resources.</p>
<p>Fortunately, Azure (in common with any reasonable cloud service) has tools to do this.  In essence, the tools consist of a file - the <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview">Azure Resource Manager</a> Template, and a set of PowerShell or command-line tools to deploy a new service.  Every time you create a mobile app in Azure App Service, Azure Resource Manager handles the actual provisioning behind the scenes.  It is much faster to use an ARM template rather than the point-and-click mechanism we have been using thus far.</p>
<h2 id="creating-an-arm-template">Creating an ARM Template<a class="headerlink" href="#creating-an-arm-template" title="Permanent link">&para;</a></h2>
<p>Let's start by examining a typical application - our Task List backend.  We've set this up a number of times within this book, so you should be familiar with it.  It has these resources within a resource group:</p>
<ul>
<li>Azure App Service with type=mobile</li>
<li>Azure App Service Plan</li>
<li>SQL Azure Logical Server</li>
<li>SQL Azure Database</li>
</ul>
<p>ARM templates have three distinct sections:</p>
<ul>
<li>Parameters provide information about the deployment set in a single place.</li>
<li>Variables are computed parameters.</li>
<li>Resources list the resources necessary to be deployed.</li>
</ul>
<p>A typical (empty) ARM template looks like this:</p>
<pre><code class="language-text">{
    &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
    },
    &quot;variables&quot;: {
    },
    &quot;resources&quot;: [
    ]
}
</code></pre>
<p>There is also an <code>outputs</code> section, but I find most templates do not require this section.</p>
<h3 id="parameters-and-variables">Parameters and Variables<a class="headerlink" href="#parameters-and-variables" title="Permanent link">&para;</a></h3>
<p>If I am creating a deployment called <code>zumobook</code>, then I always name the resources like this:</p>
<ul>
<li>Resource Group = zumobook</li>
<li>Azure App Service = zumobook</li>
<li>App Service Plan = zumobook-plan</li>
<li>SQL Azure Logical Server = zumobook-sql</li>
<li>SQL Azure Database = zumobook-db</li>
</ul>
<p>All the resources are based on the root name of the deployment.  Ideally, the deployment name would be a parameter (something I specify) and the other names would be computed.  In addition, I always make the administrator login for the SQL Azure Logical Server be <code>azure</code> and I specify the password.  Let's take a look at what that would look like:</p>
<pre><code class="language-text">{
    &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;serviceName&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;sqlServerAdminLogin&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;azure&quot;
        },
        &quot;sqlServerAdminPassword&quot;: {
            &quot;type&quot;: &quot;securestring&quot;
        }
    },
    &quot;variables&quot;: {
        &quot;appServiceName&quot;: &quot;parameters('serviceName')&quot;,
        &quot;appServicePlanName&quot;: &quot;[concat(parameters('serviceName), '-plan')]&quot;,
        &quot;sqlServerName&quot;: &quot;[concat(parameters('serviceName), '-sql')]&quot;,
        &quot;sqlDbName&quot;: &quot;[concat(parameters('serviceName), '-db')]&quot;
    },
    &quot;resources&quot;: [
    ]
}
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Variable Functions</p>
<p>Note the <code>concat()</code> is a template function.  You can find the large list of template functions in the <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-template-functions">Azure Resource Manager documentation</a>.</p>
</div>
<p>As a best practice, I abstract anything I would normally enter in creating the resource and make it either a parameter or a variable, depending on the circumstance.  I try to reduce the number of parameters and make as much as I can either a default value or a variable.  For example, one of the things that we need to set when configuring a SQL Azure database is the database size.  I could just specify this in bytes, but specifying the size in Mb is a better experience:</p>
<pre><code class="language-text">    &quot;parameters&quot;: {
        &quot;sqlDbSizeMb&quot; {
            &quot;type&quot;: &quot;int&quot;,
            &quot;minValue&quot;: 1,
            &quot;maxValue&quot;: 20,
            &quot;description&quot;: &quot;Size of the database in Mb&quot;,
            &quot;defaultValue&quot;: 5
        }
    },
    &quot;variables&quot;: {
        &quot;sqlDbSize&quot;: &quot;[mul(parameters('sqlDbSizeMb'), 1048576)]&quot;
    }
</code></pre>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<p>Resources describe the deployment of individual resources and their dependency.  There are, inevitably, more resources than you expect.   Each resource has an <code>apiVersion</code>, formatted as a date, that describes the format of the resource.  Each resource also has a <code>name</code> and a <code>type</code> plus a number of other elements that describe configuration elements.  Finally, there is an optional <code>dependsOn</code> that ensures that resources are not configured until their dependent resources are deployed.  If, for example, I look at my deployment, I can represent this as a tree:</p>
<ul>
<li>Resource Group<ul>
<li>App Service Plan<ul>
<li>App Service<ul>
<li>App Settings</li>
<li>Connection Strings</li>
<li>Continuous Deployment Source</li>
</ul>
</li>
</ul>
</li>
<li>SQL Azure Logical Server<ul>
<li>SQL Database</li>
<li>SQL Server Firewall Rules</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Let's look at each resource in turn.</p>
<h4 id="the-sql-database">The SQL Database<a class="headerlink" href="#the-sql-database" title="Permanent link">&para;</a></h4>
<p>There are actually three resources for the SQL Database - the server, the database and the firewall rule to allow other resources to connect to it:</p>
<pre><code class="language-text">{
    &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;serviceName&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;location&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;South Central US&quot;
        },
        &quot;sqlServerAdminLogin&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;azure&quot;
        },
        &quot;sqlServerAdminPassword&quot;: {
            &quot;type&quot;: &quot;securestring&quot;
        },
        &quot;sqlDbSizeMb&quot; {
            &quot;type&quot;: &quot;int&quot;,
            &quot;minValue&quot;: 1,
            &quot;maxValue&quot;: 20,
            &quot;description&quot;: &quot;Size of the database in Mb&quot;,
            &quot;defaultValue&quot;: 2
        },
        &quot;sqlDbCollation&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;SQL_Latin1_General_CP1_CI_AS&quot;
        },
        &quot;sqlDbEdition&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;Basic&quot;
        },
        &quot;sqlDbServiceObjectiveId&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;dd6d99bb-f193-4ec1-86f2-43d3bccbc49c&quot;
        },
    },
    &quot;variables&quot;: {
        &quot;sqlDbSize&quot;: &quot;[mul(parameters('sqlDbSizeMb'), 1048576)]&quot;,
        &quot;sqlServerName&quot;: &quot;[concat(parameters('serviceName), '-sql')]&quot;,
        &quot;sqlDbName&quot;: &quot;[concat(parameters('serviceName), '-db')]&quot;
    },
    &quot;resources&quot;: [
        {
            &quot;apiVersion&quot;: &quot;2014-04-01-preview&quot;,
            &quot;name&quot;: &quot;[variables('sqlServerName')]&quot;,
            &quot;type&quot;: &quot;Microsoft.Sql/servers&quot;,
            &quot;location&quot;: &quot;[parameters('location')]&quot;,
            &quot;properties&quot;: {
                &quot;administratorLogin&quot;: &quot;[parameters('sqlServerAdminLogin')]&quot;,
                &quot;administratorPassword&quot;: &quot;[parameters('sqlServerAdminPassword')]&quot;
            },
            &quot;resources&quot;: [
                {
                    &quot;apiVersion&quot;: &quot;2015-05-01-preview&quot;,
                    &quot;name&quot;: &quot;[variables('sqlDbName')]&quot;,
                    &quot;type&quot;: &quot;databases&quot;,
                    &quot;location&quot;: &quot;[parameters('location')]&quot;,
                    &quot;dependsOn&quot;: [
                        &quot;[resourceId('Microsoft.Sql/servers', parameters('sqlServerName'))]&quot;
                    ],
                    &quot;properties&quot;: {
                        &quot;edition&quot;: &quot;[parameters('sqlDbEdition')]&quot;,
                        &quot;collation&quot;: &quot;[parameters('sqlDbCollation')]&quot;,
                        &quot;maxSizeBytes&quot;: &quot;[variables('sqlDbSize')]&quot;,
                        &quot;requestedServiceObjectiveId&quot;: &quot;[parameters('sqlDbServiceObjectiveId')]&quot;
                    }
                },
                {
                    &quot;apiVersion&quot;: &quot;2014-04-01-preview&quot;,
                    &quot;name&quot;: &quot;SQLServerFirewallRules&quot;,
                    &quot;type&quot;: &quot;firewallrules&quot;,
                    &quot;location&quot;: &quot;[parameters('location')]&quot;,
                    &quot;dependsOn&quot;: [
                        &quot;[resourceId('Microsoft.Sql/servers', parameters('sqlServerName'))]&quot;
                    ],
                    &quot;properties&quot;: {
                        &quot;endIpAddress&quot;: &quot;0.0.0.0&quot;,
                        &quot;startIpAddress&quot;: &quot;0.0.0.0&quot;
                    }
                }
            ]
        },
    ]
}
</code></pre>
<p>This is a fairly lengthy example, but it incorporates a few things.  Firstly, note that I use the <code>[variables()]</code> and <code>[parameters()]</code> to bring in the variables and parameters respectively.  I also have embedded resources here.  The resource heirarchy is a tree-structure.  Each embedded resource has a <code>dependsOn</code> array that has the parent as a dependent resource.</p>
<p>You are probably wondering where you can get this information for any resource.  Microsoft Azure has a site called <a href="https://resources.azure.com/">resources.azure.com</a>.  This contains the resources that you currently have configured on your subscription.  You can set the deployment up by hand and then look at the resources to get the details:</p>
<p><img alt="Azure Resource Manager" src="../img/resource-explorer-sql.PNG" /></p>
<p>In this example, I'm showing the resource for the database.  I can extract the various pieces based on what I have set to get to this point - everything else is defaulted.  In addition, note that I can see the <code>apiVersion</code> at the top of the resource manager within the URL for the resource definition.</p>
<h4 id="the-azure-app-service-plan">The Azure App Service Plan<a class="headerlink" href="#the-azure-app-service-plan" title="Permanent link">&para;</a></h4>
<p>My next resource is the App Service Plan.  Unlike the database (which has a definite heirarchy), the App Service Plan is separate because many App Services can use the same App Service Plan.  You can think of the App Service Plan as the set of virtual machines that belong in a single scale set, and the App Services as the web sites running on top of that scale set.  The App Service Plan looks like this:</p>
<pre><code class="language-text">{
    &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;serviceName&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;location&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;South Central US&quot;
        },
        &quot;sku&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;allowedValues&quot;: [
                &quot;Free&quot;,
                &quot;Shared&quot;,
                &quot;Basic&quot;,
                &quot;Standard&quot;
            ],
            &quot;defaultValue&quot;: &quot;Basic&quot;
        },
        &quot;workerSize&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;allowedValues&quot;: [
                &quot;0&quot;, &quot;1&quot;, &quot;2&quot;
            ],
            &quot;defaultValue&quot;: &quot;0&quot;
        }
    },
     &quot;variables&quot;: {
        &quot;appServicePlanName&quot;: &quot;[concat(parameters('serviceName), '-plan')]&quot;,
    },
    &quot;resources&quot;: [
        {
            &quot;apiVersion&quot;: &quot;2015-08-01&quot;,
            &quot;name&quot;: &quot;[variables('appServicePlanName')]&quot;,
            &quot;type&quot;: &quot;Microsoft.Web/serverFarms&quot;,
            &quot;location&quot;: &quot;[parameters('location')]&quot;,
            &quot;properties&quot;: {
                &quot;name&quot;: &quot;[parameters('appServicePlanName')]&quot;,
                &quot;sku&quot;: &quot;[parameters('sku')]&quot;,
                &quot;workerSize&quot;: &quot;[parameters('workerSize')]&quot;,
                &quot;numberOfWorkers&quot;: 1
            }
        }
    ]
}
</code></pre>
<p>The <code>hostingPlanName</code> is the name of the hosting plan.  This is normally something like F1, B2, or P3.  The first letter indicates the SKU and the number indicates the size of the worker.  The size of the worker is always one less than the number that is displayed within the Azure portal.</p>
<h4 id="the-azure-app-service">The Azure App Service<a class="headerlink" href="#the-azure-app-service" title="Permanent link">&para;</a></h4>
<p>The Azure App Service is</p>
<pre><code class="language-text">{
    &quot;$schema&quot;: &quot;http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json&quot;,
    &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
    &quot;parameters&quot;: {
        &quot;serviceName&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;location&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;South Central US&quot;
        },
        &quot;sqlServerAdminLogin&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;azure&quot;
        },
        &quot;sqlServerAdminPassword&quot;: {
            &quot;type&quot;: &quot;securestring&quot;
        },
        &quot;deploymentRepoUrl&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;deploymentRepoBranch&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;defaultValue&quot;: &quot;main&quot;
        }
    },
    &quot;variables&quot;: {
        &quot;appServiceName&quot;: &quot;parameters('serviceName')&quot;,
        &quot;appServicePlanName&quot;: &quot;[concat(parameters('serviceName), '-plan')]&quot;,
        &quot;sqlServerName&quot;: &quot;[concat(parameters('serviceName), '-sql')]&quot;,
        &quot;sqlDbName&quot;: &quot;[concat(parameters('serviceName), '-db')]&quot;
    },
    &quot;resources&quot;: [
        {
            &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
            &quot;name&quot;: &quot;[variables('appServiceName')]&quot;,
            &quot;type&quot;: &quot;Microsoft.Web/sites&quot;,
            &quot;location&quot;: &quot;[parameters('location')]&quot;,
            &quot;dependsOn&quot;: [
                &quot;[resourceId('Microsoft.Web/serverFarms', parameters('appServicePlanName'))]&quot;
            ],
            &quot;properties&quot;: {
                &quot;serverFarmId&quot;: &quot;[parameters('appServicePlanName')]&quot;
            },
            &quot;resources&quot;: [
                {
                    &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
                    &quot;name&quot;: &quot;connectionstrings&quot;,
                    &quot;type&quot;: &quot;config&quot;,
                    &quot;dependsOn&quot;: [
                        &quot;[resourceId('Microsoft.Web/Sites', variables('appServiceName'))]&quot;,
                        &quot;[resourceId('Microsoft.Sql/servers', parameters('sqlServerName'))]&quot;
                    ],
                    &quot;properties&quot;: {
                        &quot;MS_TableConnectionString&quot;: { &quot;value&quot;: &quot;[concat('Data Source=tcp:', reference(concat('Microsoft.Sql/servers/', variables('sqlServerName'))).fullyQualifiedDomainName, ',1433;Initial Catalog=', variables('sqlDbName'), ';User Id=', parameters('sqlServerAdminLogin'), '@', parameters('sqlServerName'), ';Password=', parameters('sqlServerAdminPassword'), ';')]&quot;, &quot;type&quot;: &quot;SQLAzure&quot; }
                    }
                },
                {
                    &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
                    &quot;name&quot;: &quot;web&quot;,
                    &quot;type&quot;: &quot;sourcecontrols&quot;,
                    &quot;dependsOn&quot;: [
                        &quot;[resourceId('Microsoft.Web/Sites', variables('appServiceName'))]&quot;,
                        &quot;[resourceId('Microsoft.Web/Sites/config', variables('appServiceName'), 'connectionstrings')]&quot;
                    ],
                    &quot;properties&quot;: {
                        &quot;RepoUrl&quot;: &quot;[parameters('deploymentRepoUrl')]&quot;,
                        &quot;branch&quot;: &quot;[parameters('deploymentRepoBranch')]&quot;
                    }
                }
            ]
        },
    ]
}
</code></pre>
<p>In this case, we've got two dependent resources - one to set up the connection string to the database and the other to set up continuous deployment.  Both of those dependent resources have the normal <code>dependsOn</code> terms to ensure that the resources linked exist.</p>
<p>You can combine all three sections - the SQL Server, App Service Plan and App Service together.  There are overlapping parameters and variables.  You just need one copy.</p>
<h2 id="deploying-an-arm-template-on-windows">Deploying an ARM Template on Windows<a class="headerlink" href="#deploying-an-arm-template-on-windows" title="Permanent link">&para;</a></h2>
<p>Creating an Azure Resource Manager template on Windows can be done several ways, but my favorite is to use Visual Studio.</p>
<ol>
<li>Start up Visual Studio 2017 and open your solution.</li>
<li>Right-click your solution and select <strong>Add</strong> -&gt; <strong>New Project...</strong>.</li>
<li>Select <strong>Installed</strong> &gt; <strong>Visual C#</strong> &gt; <strong>Cloud</strong> &gt; <strong>Azure Resource Group</strong>.</li>
<li>Give the project a name, then click <strong>OK</strong></li>
<li>Select a template (I use <strong>Web app + SQL</strong> normally as a starting point), then click <strong>OK</strong>.</li>
</ol>
<p>Three files are created within the project:</p>
<ul>
<li>Deploy-AzureResourceGroup.ps1</li>
<li>WebSiteSQLDatabase.json (or similar)</li>
<li>WebSiteSQLDatbase.parameters.json (or similar)</li>
</ul>
<p>The <code>WebSiteSQLDatabase.json</code> is the ARM template.  The <code>.parameters.json</code> file contains the parameters for an unattended deployment.  Since the parameters contains the SQL server password, we need to be careful to ensure that the database password does not end up checked into source code.  Finally, the <code>Deploy-AzureResourceGroup.ps1</code> file is a handy PowerShell script for deploying to Azure.  Running it will be the equivalent of doing a deployment via Visual Studio.</p>
<p>You can now edit the ARM template to include any additional resources you need.  You can also edit the <code>.parameters.json</code> file to set standard values for any parameters you wish, if they don't change very often, although you won't need to do this as there is an easier way of setting parameters as we shall see.</p>
<p>There are two steps to deploying this ARM template: Validation and Deployment.  To validate the template, right-click the project and select <strong>Validate</strong>.</p>
<p><img alt="Deployment Validation Step 1" src="../img/validation-step1.PNG" /></p>
<p>Click into the <strong>Resource group</strong> and select <strong>Create new</strong>.  This allows you to select a resource group name and a location.  Once you have done that, click <strong>Create</strong>.</p>
<p>The next step is to click <strong>Edit Parameters...</strong>.  This edit the <code>.parameters.json</code> file:</p>
<p><img alt="Deployment Validation Step 2" src="../img/validation-step2.PNG" /></p>
<p>Note that we need to set a <code>hostingPlanName</code>, as indicated by the red exclamation error mark.  We can also set any other values we want.  Anything that has a null value should be entered.  Click <strong>Save</strong> when complete.</p>
<div class="admonition warn">
<p class="admonition-title">Do not save password as plain text</p>
<p>It's likely that these files will end up in source control.  You should never save passwords as plain text in any file that is going to end up in a source control repository.</p>
</div>
<p>Finally, click <strong>Validate</strong>.  You may get validation errors - fix the validation errors before continuing.  Once you have validated successfully, right-click the deployment project and select <strong>Deploy</strong>, then select the resource group you entered during validation.  You may have to type the SQL administrator password multiple times.</p>
<p>Watch the output window for a progress report on your deployment.  Once complete, log into the <a href="https://portal.azure.com/">Azure portal</a> to check the resources.  Also check that the resources match what you were expecting within the <a href="https://resources.azure.com/">Azure Resource Explorer</a>.</p>
<h2 id="deploying-an-arm-template-on-macos">Deploying an ARM Template on MacOS<a class="headerlink" href="#deploying-an-arm-template-on-macos" title="Permanent link">&para;</a></h2>
<p>The Mac does not come with the tools necessary to deploy ARM templates, so you will need to download and install them first.  In a Terminal window:</p>
<pre><code class="language-text">adrian$ curl -L https://aka.ms/InstallAzureCli | bash
adrian$ exec -l $SHELL
</code></pre>
<p>The first command does the actual installation.  It will ask you questions about where to install and confirm that it can write to files.  In general, pressing Enter will do the right thing.  The second command restarts your shell.  After the installation is complete, run <code>az</code> in your Terminal window to ensure the installation was successful.</p>
<p>The next step is to login to Azure with the CLI.  Use the <code>az login</code> command from the Terminal window.  This command will output a code to use in the next step.</p>
<p><img alt="az login output" src="../img/azcli-login-1.PNG" /></p>
<p>Note the code that is produced.  Now go to <a href="http://aka.ms/devicelogin/">http://aka.ms/devicelogin</a> and enter the code in the box provided.</p>
<p><img alt="az devicelogin page" src="../img/azcli-login-2.PNG" /></p>
<p>Enter the code, press enter, then click <strong>Continue</strong>.  You will be asked to authenticate to Azure.  Once that is complete, the terminal window will continue and you will be logged into Azure.  The <code>az login</code> command will provide a little piece of JSON to show you the subscription information to which you connected.</p>
<p>Deploying a set of resources is a two-step process on the command-line.  Firstly, you need to create a resource group.  Then you need to deploy the resources within that resource group.  To create a resource group, use:</p>
<pre><code class="language-text">az group create -l westus -n MyResourceGroup
</code></pre>
<p>You can get a list of locations that are available to you using:</p>
<pre><code class="language-text">az account list-locations | grep name
</code></pre>
<p>Take a look at the response from the <code>az group create</code> command.  Ensure that the <code>provisioningState</code> property is something that indicates success.</p>
<p>Now that we have a resource group, we can deploy our resources.  Edit the <code>.parameters.json</code> file to contain the values for your parameters.  For example:</p>
<pre><code class="language-text">{
  &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#&quot;,
  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
  &quot;parameters&quot;: {
    &quot;hostingPlanName&quot;: {
      &quot;value&quot;: &quot;Chapter8-plan&quot;
    },
    &quot;skuName&quot;: {
      &quot;value&quot;: &quot;B1&quot;
    },
    &quot;skuCapacity&quot;: {
      &quot;value&quot;: 1
    },
    &quot;administratorLogin&quot;: {
      &quot;value&quot;: &quot;azure&quot;
    },
    &quot;administratorLoginPassword&quot;: {
      &quot;value&quot;: &quot;myPassword&quot;
    },
    &quot;databaseName&quot;: {
      &quot;value&quot;: &quot;ZUMOAPPDB&quot;
    },
    &quot;edition&quot;: {
      &quot;value&quot;: &quot;Basic&quot;
    }
  }
}
</code></pre>
<div class="admonition warn">
<p class="admonition-title">Do not check in passwords!</p>
<p>If your parameters file contains password, do not check it in to source code control.</p>
</div>
<p>You can now deploy the service with the following:</p>
<pre><code class="language-text">az group deployment create --resource-group MyResourceGroup
    --mode Complete
    --parameters @WebSiteSQLDatabase.parameters.json
    --template-file WebSiteSQLDatabase.json
    --verbose
</code></pre>
<p>Although I have split this command over multiple lines, you should enter this command on one line.</p>
<div class="admonition tip">
<p class="admonition-title">Use --mode to maintain deployments</p>
<p>There are two modes for ARM deployments.  <strong>Complete</strong> will remove any resources that are not listed in your ARM template.  <strong>Incremental</strong> will only add resources to the resource group.  You can use these two modes to effectively maintain the resources in the resource group using only the command line.</p>
</div>
<p>At this point, the deployment will kick off.  It's a long running process, so expect a delay of a few minutes before it returns information.  This deployment is (deliberately) going to fail so we can see what happens when it goes wrong and how to fix it.</p>
<p>The response after this first run is this:</p>
<pre><code class="language-text">The deployment operation failed, because it was unable to cleanup. Please see https://aka.ms/arm-debug for usage details.  Correlation ID: aed1850d-22ca-4e28-b7fa-83a2ac587867
</code></pre>
<p>Start by logging into the <a href="https://portal.azure.com/">Azure portal</a>, then go to the resource group was just created, then click <strong>Deployments</strong>.  Select the latest deployment.</p>
<p><img alt="az cli deployment failed" src="../img/azcli-deploy-failed-1.PNG" /></p>
<p>Click on the failed request:</p>
<p><img alt="az cli deployment failed" src="../img/azcli-deploy-failed-2.PNG" /></p>
<p>The failed request is a lot clearer than the original failure message.  In this case, the password we entered for the SQL database did not meet the complexity requirements.  This is easily updated within the parameters file.  Then re-run the deployment.</p>
<h2 id="creating-the-arm-template">Creating the ARM Template<a class="headerlink" href="#creating-the-arm-template" title="Permanent link">&para;</a></h2>
<p>One of the issues with ARM templates is their actual creation.  There are three methods of creating ARM templates:</p>
<ol>
<li>Create a new Resource Group within Visual Studio (covered above)</li>
<li>Export a template from a Resource Group.<ul>
<li>Log in to the <a href="https://portal.azure.com/">Azure portal</a>.</li>
<li>Select your resource group.</li>
<li>In the menu, click <strong>Automation Scripts</strong>.</li>
<li>Click <strong>Download</strong>.</li>
</ul>
</li>
<li>Download <a href="https://azure.microsot.com/resources/templates/">a starter template from GitHub</a>.</li>
</ol>
<p>Which ever mechanism you choose to create the template, you will still need to edit the result by hand for your individual requirements.</p>
<!-- Images -->
<!-- Links -->

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../chapter8/testing/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Testing your Application" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Testing your Application
            </div>
          </div>
        </a>
      
      
        
        <a href="../appsvc/" class="md-footer__link md-footer__link--next" aria-label="Next: Safe Deployments" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Safe Deployments
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2020 Adrian Hall
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/adrianhall" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/FizzyInTheHall" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>