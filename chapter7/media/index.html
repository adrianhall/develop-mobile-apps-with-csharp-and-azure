
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter7/media/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>Media Services - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-media-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Media Services
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Chapter 1 - Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 1 - Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Chapter 1 - Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_pc/" class="md-nav__link">
        Your First App - PC Edition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_mac/" class="md-nav__link">
        Your First App - Mac Edition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Chapter 2 - Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 2 - Authentication" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapter 2 - Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/backend/" class="md-nav__link">
        Authentication in the Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/enterprise/" class="md-nav__link">
        Enterprise Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/social/" class="md-nav__link">
        Social Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/debugging/" class="md-nav__link">
        Debugging Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/custom/" class="md-nav__link">
        Custom Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authorization/" class="md-nav__link">
        Claims and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/realworld/" class="md-nav__link">
        Tokens in Real Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/bestpractices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Chapter 3 - Data Access and Offline Sync
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 3 - Data Access and Offline Sync" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Chapter 3 - Data Access and Offline Sync
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/dataconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/server/" class="md-nav__link">
        Implementing Table Controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/projection/" class="md-nav__link">
        Data Projection and Queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/client/" class="md-nav__link">
        The Mobile Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/relationships/" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/domainmgr/" class="md-nav__link">
        The Domain Manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Chapter 4 - Server Side Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 4 - Server Side Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Chapter 4 - Server Side Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/options/" class="md-nav__link">
        Options for Server Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/custom/" class="md-nav__link">
        Custom HTTP Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/webjobs/" class="md-nav__link">
        WebJobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Chapter 5 - Push Notifications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 5 - Push Notifications" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Chapter 5 - Push Notifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/android/" class="md-nav__link">
        Android Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/ios/" class="md-nav__link">
        iOS Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/windows/" class="md-nav__link">
        Windows Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter5/recipes/" class="md-nav__link">
        Push Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Chapter 6 - Combining Web and Mobile Apps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 6 - Combining Web and Mobile Apps" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Chapter 6 - Combining Web and Mobile Apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/mvc/" class="md-nav__link">
        MVC Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/jquery/" class="md-nav__link">
        jQuery Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/angular/" class="md-nav__link">
        Angular Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/react/" class="md-nav__link">
        React Applications
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Chapter 7 - Other Useful Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 7 - Other Useful Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Chapter 7 - Other Useful Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        Useful Azure Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../search/" class="md-nav__link">
        Azure Search
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Media Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Media Services
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-video-search-application-with-media-services" class="md-nav__link">
    The Video Search Application with Media Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-mobile-encoding-flow" class="md-nav__link">
    Creating the Mobile Encoding flow
  </a>
  
    <nav class="md-nav" aria-label="Creating the Mobile Encoding flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-pre-requisite-services" class="md-nav__link">
    Creating pre-requisite services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-azure-media-services-account" class="md-nav__link">
    Creating an Azure Media Services account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-encoding-pipeline" class="md-nav__link">
    The Encoding Pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-video-mobile-app" class="md-nav__link">
    The Video Mobile App
  </a>
  
    <nav class="md-nav" aria-label="The Video Mobile App">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    Wrap Up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Chapter 8 - Developing An App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 8 - Developing An App" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Chapter 8 - Developing An App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/developing/" class="md-nav__link">
        The Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/testing/" class="md-nav__link">
        Testing your Application
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Chapter 9 - Going to Production
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 9 - Going to Production" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Chapter 9 - Going to Production
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/arm/" class="md-nav__link">
        Repeatable Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/appsvc/" class="md-nav__link">
        Safe Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/monitoring/" class="md-nav__link">
        Monitoring and Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../xamarin_tips/" class="md-nav__link">
        Xamarin Forms Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../android_appendix/" class="md-nav__link">
        Android Developer Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vs_extensions/" class="md-nav__link">
        Visual Studio Extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-video-search-application-with-media-services" class="md-nav__link">
    The Video Search Application with Media Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-mobile-encoding-flow" class="md-nav__link">
    Creating the Mobile Encoding flow
  </a>
  
    <nav class="md-nav" aria-label="Creating the Mobile Encoding flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-pre-requisite-services" class="md-nav__link">
    Creating pre-requisite services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-an-azure-media-services-account" class="md-nav__link">
    Creating an Azure Media Services account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-encoding-pipeline" class="md-nav__link">
    The Encoding Pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-video-mobile-app" class="md-nav__link">
    The Video Mobile App
  </a>
  
    <nav class="md-nav" aria-label="The Video Mobile App">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    Wrap Up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter7/media.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="azure-media-services">Azure Media Services<a class="headerlink" href="#azure-media-services" title="Permanent link">&para;</a></h1>
<p>One of the common use cases for mobile applications involves video streaming.  In the consumer space, this can include applications like Hulu or Netflix along with video reviews and new segments in apps like CNN and CNET.  In the enterprise space, we see video learning and employee broadcast solutions.</p>
<p>Whatever their source, they have some basic functionality in common:</p>
<ul>
<li>The video asset is uploaded and converted (also known as encoding) to a streaming format.</li>
<li>A live video channel can be provided for multiplex streaming to a large audience.</li>
<li>The encoded video is provided to clients for download with a suitable web endpoint.</li>
<li>Additional services extract information from the video for search capabilities.</li>
</ul>
<p>Many enterprises wrap such functionality in a combined web and mobile site to provide streaming video for eLearning.  We are going to look at what it takes to produce the mobile side of such a site in this section.</p>
<h2 id="the-video-search-application-with-media-services">The Video Search Application with Media Services<a class="headerlink" href="#the-video-search-application-with-media-services" title="Permanent link">&para;</a></h2>
<p>We are going to produce a media services mobile application for this section, based on our last example for Azure Search.  In the new example, this is the approximate flow of the application:</p>
<p><img alt="" src="../img/media-plan.PNG" /></p>
<p>The administrator will upload an MP4 video via the Visual Studio Storage Explorer.  This will be automatically picked up by an Azure Function that encode the video, placing the encoded video into a download area.  The next Azure Function will pick up that video and use Cognitive Services on it to extract information that can be searched and insert that information into the Azure Search instance.  Finally, a third Azure Function will insert the data about the video into a database so that it can be picked up by Azure Mobile Apps.  We are going to use three distinct operations here because encoding and cognitive services are asynchronous - we want to kick them off and let them complete in their own time.</p>
<p>On the client side, we will use the Azure Search instance to find apps, display the information held within Azure Mobile Apps, and allow the user to stream the video using the video player.</p>
<p>As you can see, there are many more services in use in this example than our previous examples:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/media-services/media-services-concepts">Azure Media Services</a> is used for video encoding and streaming endpoints.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-what-are-logic-apps">Azure Logic Apps</a> are used for workflow automation.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Functions</a> are used for automation.</li>
<li><a href="https://azure.microsoft.com/en-us/services/cognitive-services/">Cognitive Services</a> are used to extract information from the videos.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/app-service/app-service-value-prop-what-is">Azure App Service</a> is used to act as a coordinator for the mobile app.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/storage/storage-introduction">Azure Storage</a> is used to store the individual video assets and for some queuing capabilities.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-technical-overview">SQL Azure</a> is used as the backing store for the Azure Mobile Apps data store.</li>
</ul>
<p>This is now a fairly typical mobile application.  We are using 8 different Azure services in a composite manner to provide the facilities needed by our application.</p>
<h2 id="creating-the-mobile-encoding-flow">Creating the Mobile Encoding flow<a class="headerlink" href="#creating-the-mobile-encoding-flow" title="Permanent link">&para;</a></h2>
<p>When I look at the architecture for our mobile backend, I see two distinct parts.  The first is the backend flow that processes the incoming videos.  As videos are uploaded, they need to be injected into a queue.  From there, a series of processes are kicked off to process the incoming video.  First, the video is encoded; then data is extracted from the video for search purposes; finally, the video is added to the SQL database so it can be searched.</p>
<p>The other flow is from the mobile client - it connects to the App Service and makes requests based on what it needs to do.  In this case, we have a set of data tables for providing data about the video and a few custom APIs for handling search and video streaming.</p>
<p>Let's take each of these in turn.   The configuration of most of the services  have already been discussed, so I will not go over them and only provide the options I used.  This includes Storage, Search, SQL Azure, and Functions.</p>
<h3 id="creating-pre-requisite-services">Creating pre-requisite services<a class="headerlink" href="#creating-pre-requisite-services" title="Permanent link">&para;</a></h3>
<p>Before I start with the new services, I need an <a href="https://docs.microsoft.com/en-us/azure/storage/storage-introduction">Azure Storage</a> account, an [Azure Search] instance and an <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Function App</a>.  I've covered all these items in previous sections, so I won't go into them here. The configuration is as follows:</p>
<ul>
<li>My <a href="https://docs.microsoft.com/en-us/azure/storage/storage-introduction">Azure Storage</a> account called <code>zumomediach7.core.windows.net</code> as <strong>General Purpose</strong> storage with <strong>LRS</strong> replication.</li>
<li>My <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview">Azure Functions</a> app called <code>zumomediach7-functions.azurewebsites.net</code> in the <strong>Consumption Plan</strong>.  I'm
   using my <code>zumomediach7</code> storage account.</li>
<li>My <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-technical-overview">SQL Azure</a> service is called <code>zumomediach7.database.windows.net</code>.</li>
<li>My <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-technical-overview">SQL Azure</a> database is called <code>videosearch</code> in the <strong>B Basic</strong> pricing plan.</li>
<li>My <a href="https://docs.microsoft.com/en-us/azure/app-service/app-service-value-prop-what-is">Azure App Service</a> is created via the <strong>Mobile App</strong> template and called <code>zumomediach7.azurewebsites.net</code>.  It
    has an <strong>B1 Basic</strong> app service plan associated with it.</li>
</ul>
<p>In addition, I've linked the SQL Azure database and storage accounts to the App Service via the Data Connections menu option.</p>
<p>Our resource group looks quite extensive now:</p>
<p><img alt="" src="../img/media-rg-view.PNG" /></p>
<p>Configuration for the services is as follows:</p>
<p><strong>Azure Storage</strong> has a container for incoming videos called <code>incoming</code>.</p>
<p><strong>Azure App Service</strong> has a basic TableController which is based on the following DTO model:</p>
<pre><code class="language-csharp">using Microsoft.Azure.Mobile.Server;

namespace Backend.DataObjects
{
    public class Video : EntityData
    {
        public string Filename { get; set; }

        public string VideoUri { get; set; }
    }
}
</code></pre>
<p>This encompasses information from the majority of the book thus far.  If you are uncertain on how to perform any of this configuration, review the appropriate sections of the book:</p>
<ul>
<li><a href="../../chapter1/firstapp_pc/">Chapter 1</a> covers creating a Mobile App.</li>
<li><a href="../../chapter4/functions/">Chapter 4</a> covers Azure Functions.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Azure Search is there</p>
<p>One of the things I've added into this project that I don't describe is the integration with Azure Search.  I use this to integrate Cognitive Services with the solution so that I can search for videos based on their content (audio, video or metadata).  You can use this as a research project.</p>
</div>
<h3 id="creating-an-azure-media-services-account">Creating an Azure Media Services account<a class="headerlink" href="#creating-an-azure-media-services-account" title="Permanent link">&para;</a></h3>
<p>So far, we've done a lot of infrastructure work.  We've generated an Azure Mobile App that our mobile app can use to retrieve information about the videos, generated an Azure Search instance with a suitable index, and a storage account for processing the videos.  We now want to move onto the meat of this section - working with video.  In order to do that, we will need an Azure Media Services account.</p>
<p>Creating an Azure Media Services account is very similar to other Azure resources.  Log in to the [Azure Portal] and open the resource group you are using to hold all the resources for this application.</p>
<ul>
<li>Click <strong>+ ADD</strong> to add a resource to the resource group.</li>
<li>Search for <strong>Media Services</strong>, select it, then click on <strong>Create</strong>.</li>
<li>Fill in the form:<ol>
<li>Select a name for your service.  It needs to be unique within the service.</li>
<li>Select your existing storage account (note the limitations on the replication policy if you use your own).</li>
<li>Ensure the region matches your storage account and other resources.</li>
</ol>
</li>
<li>Click <strong>Create</strong>.</li>
</ul>
<p><img alt="" src="../img/media-create.PNG" /></p>
<p>The Media Services accounts may take a couple of minutes to create.  Do not continue until the deployment is complete.</p>
<div class="admonition tip">
<p class="admonition-title">Testing tools for Media Services</p>
<p>If you intend to do any development in Azure Media Services, you should download and become familiar with the <a href="http://aka.ms/amse">Azure Media Services Explorer</a>. this is a test tool for Windows that allows you to upload, download, process, encode and package assets ith Azure Media Services.  You should also grow a collection of test videos.  A great starting point are <a href="http://techslides.com/sample-webm-ogg-and-mp4-video-files-for-html5">these videos from TechSlides</a>.</p>
</div>
<p>You could stop here and do all the work manually.  If you wish to check out the full set of tutorials, follow the official documentation:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/media-services/media-services-portal-upload-files">Uploading Assets</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/media-services/media-services-portal-encode">Encoding Assets</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/media-services/media-services-portal-publish">Publish Assets</a></li>
</ul>
<h3 id="the-encoding-pipeline">The Encoding Pipeline<a class="headerlink" href="#the-encoding-pipeline" title="Permanent link">&para;</a></h3>
<p>There is an <a href="https://github.com/Azure-Samples/media-services-dotnet-functions-integration/tree/master/media-functions-for-logic-app">excellent sample</a> that uses Azure Functions and Azure Logic Apps as a media workflow.  The Azure Functions do the actual processing, using the Azure Media Services SDK to communicate with the Media Services resource, and the Logic App (below) is used to control the workflow and ensure it works properly.</p>
<p><img alt="Logic App Flow" src="../img/logic-app-flow.png" /></p>
<p>To create this flow, first create the Azure Functions required by the flow in the Function App.  There are five Functions that are required:</p>
<ul>
<li>check-job-status</li>
<li>create-empty-asset</li>
<li>publish-asset</li>
<li>submit-job</li>
<li>sync-asset</li>
</ul>
<p>Start by creating the <code>shared</code> and <code>presets</code> folders.  You can do this using the <strong>App Service Editor</strong>, which is located in the <strong>Function app settings</strong>.  Just create each file and then copy-and-paste the contents into the file.</p>
<p>The source code for each function is in <a href="https://github.com/Azure-Samples/media-services-dotnet-functions-integration/tree/master/media-functions-for-logic-app">the referenced project</a>.  Create the Function from the <strong>GenericWebhook-CSharp</strong> template.  Then add the <code>project.json</code> file, which is needed to load the Media Services SDK from NuGet.  Once you save the <code>project.json</code> file, let the NuGet restore happen before continuing.  You can check the Log window to ensure it is complete.  Finally, copy-and-paste the code for the <code>run.csx</code> file.</p>
<p>Next, create a <strong>Logic App</strong>:</p>
<ol>
<li>Close the Function App to return to your Resource Group.</li>
<li>Click <strong>Add</strong> at the top of the blade.</li>
<li>Search for and select <strong>Logic App</strong>.</li>
<li>Click <strong>Create</strong>.</li>
<li>Give it a name (like <code>zumobook-logicapp</code>) and ensure the location is the same as all your other resources, then click <strong>Create</strong>.</li>
</ol>
<p>After deployment, we can set up the logic app.  Click the newly created logic app to open the <strong>Logic Apps Designer</strong>.   The first thing you want to add is a <strong>Trigger</strong> - something that triggers the execution of the workflow.  You can upload a file to OneDrive or Dropbox, for example.   In this example, I'm going to use my OneDrive <code>IncomingVideos</code> folder:</p>
<ul>
<li>Find and click <strong>OneDrive</strong>.  You may have to click <strong>SEE MORE</strong> to find it.</li>
<li>Sign in to create a connection to OneDrive.  You will also have to authorize Logic Apps to access your information.</li>
<li>Click the folder icon to Select a Folder.  Click <strong>&gt;</strong> next to Root, then <strong>IncomingVideos</strong>.  It will be listed as <code>/IncomingVideos</code>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Use the folder picker</p>
<p>Some of the triggers will encode the arguments.  Use the folder picker rather than typing in the box if your trigger doesn't seem to fire successfully.</p>
</div>
<p>Now that we have the trigger, we need to continue building the Logic App based on the diagram above.   There are a few types of steps - a Function step (where an Azure Function is called via a Webhook):</p>
<ul>
<li>Click <strong>+ New step</strong>, then <strong>Add an action</strong>.</li>
<li>Find and click <strong>Azure Functions</strong> (you may have to click <strong>SEE MORE</strong>).</li>
<li>Click <strong>Azure Functions - Choose an Azure function</strong>.  If you only have one Function App, it will be added automatically, otherwise, select the required Function App name.</li>
<li>Click <strong>Azure Functions - {your Function App}</strong>.  It will load the list of functions.</li>
<li>Click the name of the function you wish to add as the step.  The first one is <code>create-empty-asset</code>.</li>
<li>
<p>Enter the Request Body based on the comment at the top of each Azure Function.  For instance, the <code>create-empty-asset</code> should look like this:</p>
<p><img alt="" src="../img/create-empty-asset.PNG" /></p>
<p>The Name can be added by clicking <strong>Add dynamic content</strong>, then finding the appropriate field.</p>
</li>
</ul>
<p>After <code>create-empty-asset</code> has been complete, you may want to click <strong>Save</strong> to save your work.  Then continue by clicking <strong>+ New step</strong>, then <strong>Add an action</strong>.  The next step is a <strong>Create blob</strong> step.  You can use the search box to find actions to perform.  The Create blob step should look like this when you are finished.</p>
<p><img alt="" src="../img/create-blob.PNG" /></p>
<p>When you do configure this step in the Logic Apps Designer, you will note that the <code>containerPath</code> is not available from the dynamic content.  When the Webhook returns, it provides a JSON response.  The JSON response is documented at the top of the code of each Azure Function.  To enter this value, switch to the <strong>Code view</strong>, find the <strong>Create_blob</strong> action, look for the <code>queries</code> section, then insert the following value:</p>
<p><img alt="" src="../img/create-blob-2.PNG" /></p>
<p>Once you have entered the value, click <strong>Save</strong>, then <strong>Designer</strong> to switch back to the designer view.  Continue to add <code>sync-asset</code> as an action.  The request body will have to be set within the code view as it relies on the output of <code>create-empty-asset</code>.  Set the <code>body</code> section to:</p>
<pre><code class="language-text">    &quot;body&quot;: {
        &quot;assetId&quot;: &quot;@{body('create-empty-asset')['assetId']}&quot;
    }
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Use the template to create everything for you!</p>
<p>The <a href="https://github.com/Azure-Samples/media-services-dotnet-functions-integration/tree/master/media-functions-for-logic-app">sample</a> has a "Deploy to Azure" button that allows you to create all the functions and the logic app in one swoop.  It's great to understand how Logic Apps are put together, but if you would rather get on with it, just use the shortcut.</p>
</div>
<p>Linking the <code>submit-job</code> next, set the <code>body</code> in the Code view as follows:</p>
<pre><code class="language-text">    &quot;body&quot;: {
        &quot;assetId&quot;: &quot;@{body('create-empty-asset')['assetId']}&quot;,
        &quot;mesPreset&quot;: &quot;Adaptive Streaming&quot;
    }
</code></pre>
<p>The next step is an "Until" step.  You are not limited to just a straight step-flow with Logic Apps.  You can do loops and conditional execution as well.  In this case, the <code>submit-job</code> Azure Function kicks off an encoding job for the incoming video.  However, the process to encode that video can take some time.  Even a small video can take upwards of 15 minutes to encode because of queuing and process limitations.  The <strong>Add a do until</strong> step is in the "More" section after you click <strong>+ New step</strong>.  Start by clicking on <strong>Add an action</strong> within the Until loop.  Add the <code>check-job-status</code> Azure Function with a request body:</p>
<pre><code class="language-text">    &quot;body&quot;: {
        &quot;jobId&quot;: &quot;@{body('submit-job')['jobId']}&quot;
    }
</code></pre>
<p>While you are in the code view, set the "expression" field for the Until loop to the following:</p>
<pre><code class="language-text">    &quot;expression&quot;: &quot;@equals(body('check-job-status')['isRunning'], 'False')&quot;,
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Check the template if you get lost!</p>
<p>You can configure everything within the <strong>Code view</strong>, so if you get lost, just use copy-and-paste to configure each step within the logic app.</p>
</div>
<p>After the Until loop, we can add a Condition to check if the <code>isSuccessful</code> field returned by the latest invocation of <code>check-job-status</code> was true.  Click on <strong>Edit in advanced mode</strong> and enter the condition <code>@equals(body('check-job-status')['isSuccessful'], 'True')</code>.  You now have two sections - a YES and a NO section.  My NO section uses "Outlook.com - Send an email" to send me an email.  I use the <strong>File name</strong> field in the body to indicate what file was problematic.</p>
<p>On the YES side, I am going to add multiple steps.  Firstly, I will add an Azure Function for <code>publish-asset</code> with a body:</p>
<pre><code class="language-text">    &quot;body&quot;: {
        &quot;assetId&quot;: &quot;@{body('submit-job')['mes']['assetId']}&quot;
    }
</code></pre>
<p>Technically, this is now a complete encoding pipeline.  However, I also want to put the asset into the database so that my client can download it.  In the canonical example, the URL of the encoded video is published at <code>@{body('publish-asset')['playerUrl']}</code>.  I can pass that into a new Azure Function that inserts it into the database.  I can create a new function from directly within the Logic App.  However, there are a number of problems with that.  Firstly, it creates a Node.js function and I like C#.  Secondly, the code editor leaves a lot to be desired.  It's a small text box with no Intellisense.  Use the <strong>Save</strong> button to save your Logic App, then close the Logic Apps Designer and switch over to your Azure Function App.</p>
<div class="admonition tip">
<p class="admonition-title">Additional Resources Created</p>
<p>If you have created your Logic App correctly, you will note additional resources have been created for the connections to the Azure Blob storage, OneDrive and potentially Outlook.  These are part of your Logic App and should not be configured separately.</p>
</div>
<p>Use the <strong>GenericWebHook-CSharp</strong> template to create a Function called <code>insert-into-database</code>.  The code for the Webhook is as follows:</p>
<pre><code class="language-csharp">/*
This function check a job status.

Input:
{
    &quot;fileName&quot;: &quot;some-name&quot;,
    &quot;url&quot;: &quot;some-url&quot;
 }

Output:
{
    &quot;dbId&quot;: &quot;some-guid&quot;         // The new object reference
 }
*/
#r &quot;Newtonsoft.Json&quot;
#r &quot;System.Data&quot;

using System;
using System.Configuration;
using System.Data.SqlClient;
using System.Net;
using Newtonsoft.Json;

public static async Task&lt;object&gt; Run(HttpRequestMessage req, TraceWriter log)
{
    log.Info($&quot;Webhook was triggered!&quot;);

    string jsonContent = await req.Content.ReadAsStringAsync();
    dynamic data = JsonConvert.DeserializeObject(jsonContent);

    if (data.url == null || data.fileName == null) {
        return req.CreateResponse(HttpStatusCode.BadRequest, new {
            error = &quot;Please pass all properties in the input object&quot;
        });
    }

    var connectionString = ConfigurationManager.ConnectionStrings[&quot;MS_TableConnectionString&quot;].ConnectionString;
    log.Info($&quot;Using Connection String {connectionString}&quot;);

    var dbId = Guid.NewGuid().ToString(&quot;N&quot;);
    try
    {
        using (var sqlConnection = new SqlConnection(connectionString))
        {
            using (var sqlCommand = sqlConnection.CreateCommand())
            {
                log.Info(&quot;Initiating SQL Connection&quot;);
                sqlConnection.Open();

                log.Info(&quot;Executing SQL Statement&quot;);
                sqlCommand.CommandText = $&quot;INSERT INTO [dbo].[Videos] ([Id], [Deleted], [Filename], [VideoUri]) VALUES ('{dbId}', 0, '{data.fileName}', '{data.url}')&quot;;
                var rowsAffected = sqlCommand.ExecuteNonQuery();
                log.Info($&quot;{rowsAffected} rows inserted.&quot;);

                sqlConnection.Close();
            }
        }
    }
    catch (Exception ex)
    {
        return req.CreateResponse(HttpStatusCode.BadRequest, new {
            error = ex.Message
        });
    }

    return req.CreateResponse(HttpStatusCode.OK, new {
        greeting = $&quot;{dbId}&quot;
    });
}
</code></pre>
<p>This inserts a record into the Videos table with the filename and URI specified.  I can now add this function to the YES column in my Logic App by specifying the following body in the Code view:</p>
<pre><code class="language-text">    &quot;body&quot;: {
        &quot;fileName&quot;: &quot;@{triggerOutputs()['headers']['x-ms-file-name']}&quot;,
        &quot;url&quot;: &quot;@{body('publish-asset')['pathUrl']}&quot;
    }
</code></pre>
<p>There are three URLs that are returned by the previous step:</p>
<ul>
<li><code>pathUrl</code> is the path to the assets (but not the filename).</li>
<li><code>smoothUrl</code> is the real-time streaming endpoint.</li>
<li><code>playerUrl</code> is a web-page with an embedded player.</li>
</ul>
<p>You need to use the corresponding URL for your implementation.  If you are unsure, then store both the pathUrl and smoothUrl in the database (which will require a modification of the model).  The <code>playerUrl</code> can be computed on the client if you need it.</p>
<p>Before we can try this pipeline out, the other resources must be specified as Application Settings inside the Function App:</p>
<ul>
<li><code>AMSAccount</code> is the name of your Media Services resource.</li>
<li><code>AMSKey</code> is the primary key for your Media Services resource.</li>
<li><code>MediaServicesStorageAccountName</code> is the name of your Azure Storage resource.</li>
<li><code>MediaServicesStorageAccountKey</code> is the primary key for your Azure Storage resource.</li>
<li><code>MS_TableConnectionString</code> is the connection string to your video database (from your App Service).</li>
</ul>
<p>Once these are set, you are ready to test your logic app.  Go to the Logic Apps Designer and click <strong>Run</strong>.  This allows you to monitor the progress of the workflow live.  Then drop a video file in the /IncomingVideos folder of your OneDrive connection and watch the process.  It's likely that something will go wrong the first time.  In the case of Azure Functions, the error will be displayed:</p>
<p><img alt="" src="../img/logicapp-error.PNG" /></p>
<p>If the error is in a Logic App provided trigger, then consult the Diagnostics and Log search menu items under Monitoring.  For the Azure Functions triggers, it is more informative to consult the error logs in the Function App.  Open the <strong>Monitor</strong> tab to check the logs for the latest run.  Also, you can create a test run with the appropriate input object and/or place more logging in the Azure Function.  I faked this error by removing the <code>AMSAccount</code> application setting.  If you have copied the source code directly, it's likely that any errors will be in the app settings.</p>
<div class="admonition tip">
<p class="admonition-title">Insert-to-Database Failures</p>
<p>The <code>insert-to-database</code> function and the logic app will fail because the database is not created until the first request by a client.  You can either pre-create the database or use the client that is developed before you try out the encoding pipeline.</p>
</div>
<h2 id="the-video-mobile-app">The Video Mobile App<a class="headerlink" href="#the-video-mobile-app" title="Permanent link">&para;</a></h2>
<p>Now that the backend has been brought online and we can populate it with videos, it's time to turn our attention to the client app.  I've started with an app very similar to the Task List.  The models are slightly different (since the data set is different), but ultimately, the app provides a list of videos to play.  You can find <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/tree/chap7m-init/Chapter7M">the starting project on GitHub</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Use the starting point to create the database</p>
<p>In the last section, I mentioned that one of the functions would not work because the database was not created until the first client request.  You can use the starting point for the project to create the necessary database.  Create all the backend resources, then run the client to create the database, then test out the encoding pipeline.</p>
</div>
<p>You can integrate any video player that supports a streaming endpoint, and there are several to choose from - each with their own complexities for integration.  For simplicity, I am going to integrate the Azure Media Services Player - a web-based streaming media player which I will integrate into a <code>WebView</code> within the page.  Let's start by hooking up a new view in the shared project.  The new view is called <code>Pages/VideoDetail.xaml</code>:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;VideoApp.Pages.VideoDetail&quot;
    xmlns=&quot;http://xamarin.com/schemas/2014/forms&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;&gt;
    &lt;StackLayout&gt;
        &lt;WebView
            x:Name=&quot;browser&quot;
            HorizontalOptions=&quot;FillAndExpand&quot;
            VerticalOptions=&quot;FillAndExpand&quot; /&gt;
    &lt;/StackLayout&gt;
&lt;/ContentPage&gt;
</code></pre>
<p>This page creates a <code>WebView</code> that occupies the entire page.  There is a backing C# source file as well that implements the viewer:</p>
<pre><code class="language-csharp">using System;
using System.Collections.Generic;
using System.Linq;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoApp.Pages
{
    [XamlCompilation(XamlCompilationOptions.Compile)]
    public partial class VideoDetail : ContentPage
    {
        public VideoDetail (Models.Video video)
        {
            InitializeComponent ();

            var htmlSource = new HtmlWebViewSource();
            var sourceInfo = @&quot;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Test&lt;/title&gt;
        &lt;link href=&quot;&quot;https://amp.azure.net/libs/amp/1.8.3/skins/amp-default/azuremediaplayer.min.css&quot;&quot; rel=&quot;&quot;stylesheet&quot;&quot;&gt;
        &lt;script src=&quot;&quot;https://amp.azure.net/libs/amp/1.8.3/azuremediaplayer.min.js&quot;&quot;&gt;&lt;/script&gt;
     &lt;/head&gt;
    &lt;body&gt;
        &lt;video id=&quot;&quot;azuremediaplayer&quot;&quot; class=&quot;&quot;azuremediaplayer amp-default-skin amp-big-play-centered&quot;&quot; tabindex=&quot;&quot;0&quot;&quot;&gt;&lt;/video&gt;
        &lt;script&gt;
var myOptions = {
    &quot;&quot;nativeControlsForTouch&quot;&quot;: false,
    controls: true,
    autoplay: true,
    width: &quot;&quot;640&quot;&quot;,
    height: &quot;&quot;400&quot;&quot;,
};
myPlayer = amp(&quot;&quot;azuremediaplayer&quot;&quot;, myOptions);
myPlayer.src([
    {
    src: &quot;&quot;{Binding Source}&quot;&quot;,
    type: &quot;&quot;application/vnd.ms-sstr+xml&quot;&quot;
    }
]);
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;;
            htmlSource.Html = sourceInfo.Replace(&quot;{Binding Source}&quot;, video.VideoUri);
            browser.Source = htmlSource;
        }
    }
}
</code></pre>
<p>The HTML and Javascript libraries that I use here are provided by Azure Media Services.  You can find them as follows:</p>
<ol>
<li>Start <a href="http://aka.ms/amse">Azure Media Services Explorer</a> and connect to your Media Services account.</li>
<li>Right-click a published video, then select <strong>Playback</strong> -&gt; <strong>with Azure Media Player</strong>.</li>
<li>A web-page will open.  Click <strong>Code</strong> -&gt; <strong>Get Player Code</strong> (under the video).</li>
</ol>
<p>The code will be displayed:</p>
<p><img alt="" src="../img/code-for-amsplayer.PNG" /></p>
<p>I replaced the <code>src</code> object with something I can string-replace later on.  The player is completely cross-platform.  You do, however, have to specify the height and width.  One of the advantages of using a native control is that it will set the height and width for you.</p>
<h3 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">&para;</a></h3>
<p>Obviously, this isn't the prettiest app that has been produced.  However, it is functional and it demonstrates the basic capabilities.  We don't have to stop where we did, however.</p>
<ul>
<li>We could use <a href="https://azure.microsoft.com/en-us/services/cognitive-services/">Cognitive Services</a> to extract the audio track and submit to an <a href="../search/">Azure Search</a> facility.  We could then allow searching of the Azure Search facility to come up with a list of videos that match based on the audio track.  This is, quite frankly, something that still amazes me and something that we could not do without the Azure Cloud.  The <a href="https://github.com/Azure-Samples/media-services-dotnet-functions-integration/tree/master/media-functions-for-logic-app">Cognitive Services integration</a> is available as the advanced option in the sample for the media processing workflow.</li>
<li>We could adjust the <code>insert-into-database</code> Function to extract metadata from the MP4 file.  The MP4 file contains a whole host of information.  This can be inserted into the database so you can display it.  You could also add a JSON file in the upload to provide additional content that is inserted into the database.</li>
<li>We could provide ratings and other controls on the list.  This can be stored on the mobile backend as well to provide information to other users.</li>
</ul>
<p>Video media is one of those areas of development that is complex to understand and implement, but has so much potential in the mobile space.</p>
<!-- Images -->
<!-- Azure Service Definition Overviews -->

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../search/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Azure Search" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Azure Search
            </div>
          </div>
        </a>
      
      
        
        <a href="../../chapter8/developing/" class="md-footer__link md-footer__link--next" aria-label="Next: The Development Environment" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              The Development Environment
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2020 Adrian Hall
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/adrianhall" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/FizzyInTheHall" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>