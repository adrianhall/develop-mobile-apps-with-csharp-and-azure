
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/android/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>Android Push - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preparing-for-development" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Android Push
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Chapter 1 - Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 1 - Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Chapter 1 - Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_pc/" class="md-nav__link">
        Your First App - PC Edition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_mac/" class="md-nav__link">
        Your First App - Mac Edition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Chapter 2 - Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 2 - Authentication" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapter 2 - Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/backend/" class="md-nav__link">
        Authentication in the Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/enterprise/" class="md-nav__link">
        Enterprise Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/social/" class="md-nav__link">
        Social Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/debugging/" class="md-nav__link">
        Debugging Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/custom/" class="md-nav__link">
        Custom Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authorization/" class="md-nav__link">
        Claims and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/realworld/" class="md-nav__link">
        Tokens in Real Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/bestpractices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Chapter 3 - Data Access and Offline Sync
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 3 - Data Access and Offline Sync" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Chapter 3 - Data Access and Offline Sync
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/dataconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/server/" class="md-nav__link">
        Implementing Table Controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/projection/" class="md-nav__link">
        Data Projection and Queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/client/" class="md-nav__link">
        The Mobile Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/relationships/" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/domainmgr/" class="md-nav__link">
        The Domain Manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Chapter 4 - Server Side Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 4 - Server Side Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Chapter 4 - Server Side Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/options/" class="md-nav__link">
        Options for Server Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/custom/" class="md-nav__link">
        Custom HTTP Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/webjobs/" class="md-nav__link">
        WebJobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Chapter 5 - Push Notifications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 5 - Push Notifications" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Chapter 5 - Push Notifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Android Push
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Android Push
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-for-development" class="md-nav__link">
    Preparing for development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-your-app-with-fcm" class="md-nav__link">
    Registering your app with FCM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-notification-hubs-to-fcm" class="md-nav__link">
    Linking Notification Hubs to FCM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-for-push-notifications" class="md-nav__link">
    Registering for Push Notifications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processing-a-push-notification" class="md-nav__link">
    Processing a Push Notification
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ios/" class="md-nav__link">
        iOS Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        Windows Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../recipes/" class="md-nav__link">
        Push Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Chapter 6 - Combining Web and Mobile Apps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 6 - Combining Web and Mobile Apps" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Chapter 6 - Combining Web and Mobile Apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/mvc/" class="md-nav__link">
        MVC Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/jquery/" class="md-nav__link">
        jQuery Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/angular/" class="md-nav__link">
        Angular Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/react/" class="md-nav__link">
        React Applications
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Chapter 7 - Other Useful Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 7 - Other Useful Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Chapter 7 - Other Useful Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/services/" class="md-nav__link">
        Useful Azure Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/search/" class="md-nav__link">
        Azure Search
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/media/" class="md-nav__link">
        Media Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Chapter 8 - Developing An App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 8 - Developing An App" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Chapter 8 - Developing An App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/developing/" class="md-nav__link">
        The Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/testing/" class="md-nav__link">
        Testing your Application
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Chapter 9 - Going to Production
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 9 - Going to Production" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Chapter 9 - Going to Production
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/arm/" class="md-nav__link">
        Repeatable Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/appsvc/" class="md-nav__link">
        Safe Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/monitoring/" class="md-nav__link">
        Monitoring and Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../xamarin_tips/" class="md-nav__link">
        Xamarin Forms Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../android_appendix/" class="md-nav__link">
        Android Developer Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vs_extensions/" class="md-nav__link">
        Visual Studio Extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-for-development" class="md-nav__link">
    Preparing for development
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-your-app-with-fcm" class="md-nav__link">
    Registering your app with FCM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linking-notification-hubs-to-fcm" class="md-nav__link">
    Linking Notification Hubs to FCM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-for-push-notifications" class="md-nav__link">
    Registering for Push Notifications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processing-a-push-notification" class="md-nav__link">
    Processing a Push Notification
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter5/android.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Android Push</h1>

<p>Push notifications for Android devices are handled by Firebase Cloud Messaging - a service run by Google.  This service used to be called <em>Google Cloud Messaging</em> and nothing has really changed since they rebranded the service.  Google wanted to bundle all their mobile offerings under one roof.  Firebase Cloud Messaging can still be used independently of the rest of Firebase.</p>
<h2 id="preparing-for-development">Preparing for development<a class="headerlink" href="#preparing-for-development" title="Permanent link">&para;</a></h2>
<div class="admonition warn">
<p class="admonition-title">Warn</p>
<p>Push notifications are one of those areas where it really pays to have a real device instead of an emulator.  It's frustrating to bump into so many issues with emulation, but it's almost inevitable.  If you are having problems, use a real device.</p>
</div>
<p>Before continuing, you will need an Android Emulator with the Google Play SDKs installed, or a real Android device.  You cannot use a vanilla emulator without the Google Play SDKs.  To set up an emulator with the appropriate SDKs.</p>
<div class="admonition tip">
<p class="admonition-title">Visual Studio 2017</p>
<p>Visual Studio 2017 provides four emulators and all of them include the Google APIs already, so you can skip this section if you are using Visual Studio 2017.  You still need to create an appropriate emulator if you are using Visual Studio 2015 or earlier.</p>
</div>
<p>In Visual Studio:</p>
<ul>
<li>Click <strong>Tools</strong> -&gt; <strong>Android</strong> -&gt; <strong>Android SDK Manager</strong>.</li>
<li>Expand <strong>Android 6.0 (API 23)</strong>.</li>
<li>Select <strong>Google APIs Intel x86 Atom System Image</strong>.</li>
<li>Expand the <strong>Extras</strong>.</li>
<li>Select <strong>Google Play Services</strong>.</li>
<li>Click on <strong>Install</strong>.</li>
</ul>
<p>Wait for the installation to complete, then close the Android SDK Manager.</p>
<div class="admonition tip">
<p class="admonition-title">Disable Hyper-V</p>
<p>The Android Virtual Device from Google is incompatible with Hyper-V.  To disable Hyper-V, open a PowerShell prompt as an Administrator, then run the command  <code>bcdedit /set hypervisorlaunchtype off</code> and reboot.  You may also have to install <a href="https://software.intel.com/en-us/android/articles/intel-hardware-accelerated-execution-manager">Intel HAXM</a>, which is available for download through the Android SDK Manager but may need to be installed separately, depending on how you installed the Android SDK.</p>
</div>
<ul>
<li>Click <strong>Tools</strong> -&gt; <strong>Android</strong> -&gt; <strong>Android Emulator Manager</strong>.</li>
<li>Click <strong>Create...</strong></li>
<li>Fill in the form.   You must specify:<ul>
<li>Target: <strong>Android 6.0 - API Level 23</strong></li>
<li>CPU/ABI: <strong>Google APIs Intel Atom (x86)</strong></li>
<li>Memory Options: RAM: <strong>768</strong>
Other than these settings, there is a lot of flexibility.  Consult the <a href="https://developer.android.com/studio/run/managing-avds.html">Android documentation</a>.</li>
</ul>
</li>
<li>Once ready, click on <strong>OK</strong> to create the device.</li>
<li>Click <strong>OK</strong> to confirm the creation.</li>
</ul>
<p>Test that the emulator device works:</p>
<ul>
<li>Click the device you just created.</li>
<li>Click <strong>Start...</strong>.</li>
<li>Click <strong>Launch...</strong>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Fixing Permission Denied</p>
<p>You may get an error for <code>...\/system.img: Permission denied</code>.  To fix this, open up a File Explorer and go to <code>C:\Program Files (x86)\Android</code>.  Right-click on <code>android-sdk</code> and select <strong>Properties</strong>.  Click the <strong>Security</strong> tab, then <strong>Edit</strong>.  Highlight Users in the Group or user names box, select Allow Full control in the Permissions for Users box, then click <strong>OK</strong>.  Once the Security settings have been applied, you can try to start the emulator again.</p>
</div>
<p>If the device starts and looks like a regular Android device, then you've completed the task.  You must have a working emulator or real device before continuing, so don't continue until you've got something working.</p>
<h2 id="registering-your-app-with-fcm">Registering your app with FCM<a class="headerlink" href="#registering-your-app-with-fcm" title="Permanent link">&para;</a></h2>
<p>To start, you need a Firebase Developer Account.  Go to the <a href="https://firebase.google.com/console/">Firebase Developer Console</a> and sign in with a Google account.  If you have never been a Google developer before, the site will ask you to agree to their legal terms so your account can be converted to a developer account.</p>
<p>Once done, create a Firebase application.  If you previously created a Google project for authentication, you can import the Google project instead.  The effect is the same - you need a Firebase project at the end.</p>
<p>Click on <strong>Add Firebase to your Android app</strong>.  You aren't actually adding Firebase - just the push capabilities.</p>
<p><img alt="" src="../img/push-fcm-1.PNG" /></p>
<p>The next screen is confusing - it's talking about Android native development and we are developing in Xamarin Forms.  We need to enter a namespace, so use the namespace of your application.  The actual value does not matter as we are not using the majority of the Firebase SDK:</p>
<p><img alt="" src="../img/push-fcm-2.PNG" /></p>
<p>Click on <strong>ADD APP</strong>, then on <strong>CONTINUE</strong>, and finally <strong>FINISH</strong>.  The process will download a file: <code>google-services.json</code>, which is used by Android Studio in native applications.  The instructions along the way are also for Android Studio.</p>
<p>Once done, click on the cog next to your project name and select <strong>PROJECT SETTINGS</strong>.</p>
<p><img alt="" src="../img/push-fcm-3.PNG" /></p>
<p>Click on the <strong>CLOUD MESSAGING</strong> tab:</p>
<p><img alt="" src="../img/push-fcm-4.PNG" /></p>
<p>This gives you a server key and a sender ID.  You need the "Legacy Server Key" if you have two keys listed.  We will need these later.</p>
<h2 id="linking-notification-hubs-to-fcm">Linking Notification Hubs to FCM<a class="headerlink" href="#linking-notification-hubs-to-fcm" title="Permanent link">&para;</a></h2>
<p>Now that you have the server key and sender ID, you can enter that information into Notification Hubs to enable it to push to your Android clients.</p>
<ul>
<li>Log in to the <a href="https://portal.azure.com">Azure portal</a>.</li>
<li>Find your App Service:<ul>
<li>Use <strong>All Resources</strong>, then enter the name in the <strong>Filter items...</strong> box.</li>
<li>Use <strong>Resource Groups</strong>, find the resource group, then click on the items.
Which ever way you choose, enter the App Service.</li>
</ul>
</li>
<li>Select <strong>Push</strong> from the menu (under <strong>SETTINGS</strong>).</li>
<li>Click <strong>Configure push notification services</strong>.</li>
<li>Click <strong>Google (GCM)</strong>.</li>
<li>Enter the server key in the <strong>API Key</strong> box.</li>
<li>Click on <strong>Save</strong>.</li>
</ul>
<p>We can now turn our attention to the mobile client.</p>
<h2 id="registering-for-push-notifications">Registering for Push Notifications<a class="headerlink" href="#registering-for-push-notifications" title="Permanent link">&para;</a></h2>
<p>Registering for push notification is always a per-platform piece, so it has to go into the platform specific code.  We've seen what this means in terms of code before.  First, we create a new method definition in the <code>IPlatformProvider.cs</code> interface and the <code>ICloudService.cs</code> interface, then we update the <code>AzureCloudService.cs</code> to call the platform-specific code.  Finally, we need an platform-specific implementation.</p>
<p>First, the <code>IPlatformProvider.cs</code> - I'm going to add a new method: <code>RegisterForPushNotifications()</code> that will do all the work for me:</p>
<pre><code class="language-csharp">using System.Threading.Tasks;
using Microsoft.WindowsAzure.MobileServices;

namespace TaskList.Abstractions
{
    public interface IPlatformProvider
    {
        MobileServiceUser RetrieveTokenFromSecureStore();

        void StoreTokenInSecureStore(MobileServiceUser user);

        void RemoveTokenFromSecureStore();

        Task&lt;MobileServiceUser&gt; LoginAsync(MobileServiceClient client);

        Task RegisterForPushNotifications(MobileServiceClient client);
    }
}
</code></pre>
<p>The first four methods are from our authentication work.  The final method is our new method.  There is a similar method in the <code>ICloudService.cs</code> interface:</p>
<pre><code class="language-csharp">using System.Threading.Tasks;
using Microsoft.WindowsAzure.MobileServices;
using TaskList.Models;

namespace TaskList.Abstractions
{
    public interface ICloudService
    {
        ICloudTable&lt;T&gt; GetTable&lt;T&gt;() where T : TableData;

        Task&lt;MobileServiceUser&gt; LoginAsync();

        Task LogoutAsync();

        Task&lt;AppServiceIdentity&gt; GetIdentityAsync();

        Task RegisterForPushNotifications();
    }
}
</code></pre>
<p>We also have a concrete implementation of this in <code>AzureCloudService.cs</code> that simply calls the platform specific version:</p>
<pre><code class="language-csharp">    public async Task RegisterForPushNotifications()
    {
        var platformProvider = DependencyService.Get&lt;IPlatformProvider&gt;();
        await platformProvider.RegisterForPushNotifications(client);
    }
</code></pre>
<p>These are required irrespective of whether you are implementing iOS, Android, UWP or any combination of those platforms.  Let's now work with the Android platform-specific code.  Before we look at the platform specific code, we are going to need a library that implements the GCM/FCM library.</p>
<div class="admonition tip">
<p class="admonition-title">Alternative Libraries</p>
<p>We are going to use a fairly old and venerable GCM Client.  There is an official Xamarin client for <a href="https://console.firebase.google.com/">Google Play Services</a> for example.  Feel free to experiment with other libraries.  The process for registration tends to be very similar between SDKs.</p>
</div>
<ul>
<li>Right-click on <strong>Components</strong> in the <strong>TaskList.Droid</strong> project.</li>
<li>Select <strong>Get More Components...</strong>.</li>
<li>Enter <strong>Google Cloud Messaging Client</strong> in the search box.</li>
<li>Select the <strong>Google Cloud Messaging Client</strong>.</li>
<li>Click <strong>Add to App</strong>.</li>
</ul>
<p>Now that you have the library installed, you can configure registration with FCM as follows:</p>
<pre><code class="language-csharp">    public void Init(Context context)
    {
        RootView = context;
        AccountStore = AccountStore.Create(context);

        try
        {
            // Check to see if this client has the right permissions
            GcmClient.CheckDevice(RootView);
            GcmClient.CheckManifest(RootView);

            // Register for push
            GcmClient.Register(RootView, GcmHandler.SenderId);
            Debug.WriteLine($&quot;GcmClient: Registered for push with FCM: {GcmClient.GetRegistrationId(RootView)}&quot;);
        }
        catch (Exception ex)
        {
            Debug.WriteLine($&quot;GcmClient: Cannot register for push: {ex.Message}&quot;);
        }
    }
</code></pre>
<p>Most of this <code>Init()</code> method existed before.  The <code>GcmClient</code> calls are new.  The first two calls ensure that the mobile device is capable of handling registrations and that the application is properly configured.  The <code>GcmClient.Register()</code> call registers with FCM.  I'm dumping the registration ID we get back to the debug channel.</p>
<p>We also need to define a handler for the FCM calls.  FCM will send an out-of-band notification to the Android OS, which will figure out which application to wake up, and then call the defined handler.  Mine is in <code>Services\GcmHandler.cs</code>:</p>
<pre><code class="language-csharp">using Android.App;
using Android.Content;
using Android.Util;
using Gcm.Client;

[assembly: Permission(Name = &quot;@PACKAGE_NAME@.permission.C2D_MESSAGE&quot;)]
[assembly: UsesPermission(Name = &quot;@PACKAGE_NAME@.permission.C2D_MESSAGE&quot;)]
[assembly: UsesPermission(Name = &quot;com.google.android.c2dm.permission.RECEIVE&quot;)]
[assembly: UsesPermission(Name = &quot;android.permission.INTERNET&quot;)]
[assembly: UsesPermission(Name = &quot;android.permission.WAKE_LOCK&quot;)]
namespace TaskList.Droid.Services
{
    [BroadcastReceiver(Permission = Constants.PERMISSION_GCM_INTENTS)]
    [IntentFilter(new string[] { Constants.INTENT_FROM_GCM_MESSAGE }, Categories = new string[] { &quot;@PACKAGE_NAME@&quot; })]
    [IntentFilter(new string[] { Constants.INTENT_FROM_GCM_REGISTRATION_CALLBACK }, Categories = new string[] { &quot;@PACKAGE_NAME@&quot; })]
    [IntentFilter(new string[] { Constants.INTENT_FROM_GCM_LIBRARY_RETRY }, Categories = new string[] { &quot;@PACKAGE_NAME@&quot; })]
    public class GcmHandler : GcmBroadcastReceiverBase&lt;GcmService&gt;
    {
        // Replace with your Sender ID from the Firebase Console
        public static string[] SenderId = new string[] { &quot;493509995880&quot; };

    }

    [Service]
    public class GcmService : GcmServiceBase
    {
        public static string RegistrationID { get; private set; }

        public GcmService() : base(GcmHandler.SenderId)
        {

        }

        protected override void OnMessage(Context context, Intent intent)
        {
            Log.Info(&quot;GcmService&quot;, $&quot;Message {intent.ToString()}&quot;);
        }

        protected override void OnError(Context context, string errorId)
        {
            Log.Error(&quot;GcmService&quot;, $&quot;ERROR: {errorId}&quot;);
        }

        protected override void OnRegistered(Context context, string registrationId)
        {
            Log.Info(&quot;GcmService&quot;, $&quot;Registered: {registrationId}&quot;);
            GcmService.RegistrationID = registrationId;
        }

        protected override void OnUnRegistered(Context context, string registrationId)
        {
            Log.Info(&quot;GcmService&quot;, $&quot;Unregistered device from FCM&quot;);
            GcmService.RegistrationID = null;
        }
    }
}
</code></pre>
<div class="admonition warn">
<p class="admonition-title">Replace the SenderId</p>
<p>You must replace the SenderId with your sender ID that you copied from the Firebase Console.</p>
</div>
<p>Let's start at the top.  In order to use push notifications from Firebase, we need to tell our application to ask for that permission.  We need the OS to wake us up (WAKE_LOCK), access the Internet (INTERNET), and handle push notifications (C2D_MESSAGE and RECEIVE).</p>
<p>We use the GcmHandler to register a receiver.  This is done via the intents that are provided by the GcmClient package.  The class that will receive the events is the <code>GcmService</code> class.  There are four methods that must be defined there - registration, un-registration, messages and errors.  Right now, I'm just setting up some debug messages so I can see what is going on.</p>
<p>We can test this right now.  Place a breakpoint on each <code>Log</code> method, then run the app.</p>
<div class="admonition tip">
<p class="admonition-title">The application could not be started</p>
<p>If you get the error "The application could not be started.  Ensure that the application has been installed to the target device and has a launchable activity (MainLauncher=true)".  This is because the Android system can't handle package names in upper case.  Right-click the <strong>TaskList.Droid</strong> project and select <strong>Properties</strong> then <strong>Android Manifest</strong>.  Change the <strong>Package name</strong> field to something lower case.</p>
</div>
<p>Once the application launches, the <code>GcmService.OnRegistered()</code> method is hit immediately.  You will be able to see the registration ID.  Click on <strong>Continue</strong>.  The device is now registered with FCM.  Note the registration ID as you will need it in the next step.</p>
<p>Send an ad-hoc message as follows:</p>
<ul>
<li>Go to the <a href="https://console.firebase.google.com/">Firebase Developer Console</a>.</li>
<li>Click your project.</li>
<li>Click <strong>Notifications</strong> in the left hand nav.</li>
<li>Click <strong>Send your first message</strong>.</li>
<li>Enter something in the <strong>Message text</strong> box.</li>
<li>Select <strong>Single device</strong> under Target.</li>
<li>Paste the registration ID in the <strong>GCM registration token</strong> box.</li>
<li>
<p>Click <strong>Send Message</strong>.</p>
<p><img alt="" src="../img/push-fcm-5.PNG" /></p>
</li>
<li>
<p>Click <strong>Send</strong>.</p>
</li>
</ul>
<p>At this point the breakpoint in <code>GcmService.OnMessage()</code> will be hit.  You can examine the push by looking at the <code>intent</code> variable.  Click on <strong>Stop</strong> to stop the application.</p>
<p>Moving onto registration with Notification Hubs, we need to pass the registration ID we received from FCM to our mobile backend.  The App Service will ensure our device is registered properly.  We need to do this at the appropriate time, and that depends on a lot of factors.  There is no problem with registering multiple times if our requirements change.  In this app, I might choose to register at the beginning of the app, once the user has authenticated and if I had a settings page, when the settings changed.  This activity is done in the <code>Services\DroidPlatformProvider.cs</code> file:</p>
<pre><code class="language-csharp">    public async Task RegisterForPushNotifications(MobileServiceClient client)
    {
        if (GcmClient.IsRegistered(RootView))
        {
            try
            {
                var registrationId = GcmClient.GetRegistrationId(RootView);
                //var push = client.GetPush();
                //await push.RegisterAsync(registrationId);

                var installation = new DeviceInstallation
                {
                    InstallationId = client.InstallationId,
                    Platform = &quot;gcm&quot;,
                    PushChannel = registrationId
                };
                // Set up tags to request
                installation.Tags.Add(&quot;topic:Sports&quot;);
                // Set up templates to request
                PushTemplate genericTemplate = new PushTemplate
                {
                    Body = @&quot;{&quot;&quot;data&quot;&quot;:{&quot;&quot;message&quot;&quot;:&quot;&quot;$(message)&quot;&quot;}}&quot;
                };
                installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);

                // Register with NH
                var response = await client.InvokeApiAsync&lt;DeviceInstallation, DeviceInstallation&gt;(
                    $&quot;/push/installations/{client.InstallationId}&quot;,
                    installation,
                    HttpMethod.Put,
                    new Dictionary&lt;string, string&gt;());
            }
            catch (Exception ex)
            {
                Log.Error(&quot;DroidPlatformProvider&quot;, $&quot;Could not register with NH: {ex.Message}&quot;);
            }
        }
        else
        {
            Log.Error(&quot;DroidPlatformProvider&quot;, $&quot;Not registered with FCM&quot;);
        }
    }
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Registering without Tags</p>
<p>You can also register without tags using the commented-out single line of code <code>push.RegisterAsync(registrationId);</code></p>
</div>
<p>You should call <code>RegisterForPushNotifications()</code> whenever you feel that the definition of the push endpoint should change.  In my application, I added the registration after the <code>LoginAsync()</code> method in the <code>ViewModels\EntryPageViewModel.cs</code> file:</p>
<pre><code class="language-csharp">    async Task ExecuteLoginCommand()
    {
        if (IsBusy)
            return;
        IsBusy = true;

        try
        {
            var cloudService = ServiceLocator.Instance.Resolve&lt;ICloudService&gt;();
            await cloudService.LoginAsync();
            await cloudService.RegisterForPushNotifications();
            Application.Current.MainPage = new NavigationPage(new Pages.TaskList());
        }
        catch (Exception ex)
        {
            await Application.Current.MainPage.DisplayAlert(&quot;Login Failed&quot;, ex.Message, &quot;OK&quot;);
        }
        finally
        {
            IsBusy = false;
        }
    }
</code></pre>
<p>Run the application again, with the same breakpoint in the <code>GcmService.OnMessage()</code> method.  You can remove the other breakpoints at this point.  Log into the application this time.  Let's explore some of the debugging tools for Notification Hubs.  Within Visual Studio, you can use <strong>View</strong> -&gt; <strong>Server Explorer</strong> to open the server explorer.  Expand the <strong>Azure</strong> node then the <strong>Notification Hubs</strong> node:</p>
<p><img alt="" src="../img/push-nh-vs1.PNG" /></p>
<p>Double-click on your Notification Hub to open the developer console.  This provides two functions.  Firstly, we can click on the <strong>Device Registrations</strong> tab:</p>
<p><img alt="" src="../img/push-nh-vs2.PNG" /></p>
<p>We can see the registration of our test emulator device.  Note that our request for the <code>topic:Sports</code> tag has also been honored.  If we did not configure that tag within the Push blade in the portal, that would not have been added to our registration.</p>
<p>We can also send to a specific device using the test send facility.  Click over to the <strong>Test Send</strong> facility.  Since we only have one device, we can use broadcast. Each installation will also be given a tag: <code>$InstallationId:{guid}</code>, where {guid} is the installation ID.  Select <strong>Google (GCM)</strong> -&gt; <strong>Default</strong> to send a message to FCM.  The body will be filled in for you.</p>
<p>Since we have already set a breakpoint at the <code>OnMessage()</code> method in <code>GcmService.cs</code>, our app is running and we have entered the app and logged in, click <strong>Send</strong>.  The breakpoint should be triggered within a reasonable amount of time.  I'd like to say that it will be near instantaneous, but push notifications may take some time depending on what is happening within the push notification system at the time.  The push should not take more than a couple of minutes to arrive and will likely arrive much quicker.</p>
<p><img alt="" src="../img/push-nh-vs3.PNG" /></p>
<p>We now have the full registration lifecycle working and we can do a test send to hit the right piece of code.</p>
<h2 id="processing-a-push-notification">Processing a Push Notification<a class="headerlink" href="#processing-a-push-notification" title="Permanent link">&para;</a></h2>
<p>Processing of push notifications is done within your mobile app, so you can process the push notifications however you want.  For example, you may want to silently pull a specific record from the server and insert it into your SQLite offline cache when a push arrives, or you may want to pop up a message that opens the mobile app.</p>
<p>In this example, we are going to show the message that comes in the <code>message</code> field of the data block.  There are more examples in the <a href="../recipes/">recipes section</a>.  The <code>OnMessage()</code> method in <code>GcmService.cs</code> is triggered on a push.  A simple notification looks like this:</p>
<pre><code class="language-csharp">    protected override void OnMessage(Context context, Intent intent)
    {
        Log.Info(&quot;GcmService&quot;, $&quot;Message {intent.ToString()}&quot;);

        var message = intent.Extras.GetString(&quot;message&quot;);

        var notificationManager = GetSystemService(Context.NotificationService) as NotificationManager;
        var uiIntent = new Intent(context, typeof(MainActivity));
        NotificationCompat.Builder builder = new NotificationCompat.Builder(context);

        var notification = builder.SetContentIntent(PendingIntent.GetActivity(context, 0, uiIntent, 0))
            .SetSmallIcon(Android.Resource.Drawable.SymDefAppIcon)
            .SetTicker(&quot;TaskList&quot;)
            .SetContentTitle(&quot;TaskList&quot;)
            .SetContentText(message)
            .SetSound(RingtoneManager.GetDefaultUri(RingtoneType.Notification))
            .SetAutoCancel(true)
            .Build();

        notificationManager.Notify(1, notification);
    }
</code></pre>
<p>The major thing to note here is how we get the contents of the message.  The data block from the Notification Hub is received by the Intent into the Extras property.  If you have other properties in that block, you can retrieve them the same way.  The message field is standard, but you can pass other things.  An example would be to pass the table name and ID of an inserted record.</p>
<!-- Images -->
<!-- Links -->
<p>[5]:</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../concepts/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Concepts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Concepts
            </div>
          </div>
        </a>
      
      
        
        <a href="../ios/" class="md-footer__link md-footer__link--next" aria-label="Next: iOS Push" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              iOS Push
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2020 Adrian Hall
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/adrianhall" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/FizzyInTheHall" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>