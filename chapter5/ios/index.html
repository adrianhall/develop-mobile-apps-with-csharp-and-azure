
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/ios/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>iOS Push - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#registering-with-apns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-header__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              iOS Push
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-nav__button md-logo" aria-label="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Chapter 1 - Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 1 - Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Chapter 1 - Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_pc/" class="md-nav__link">
        Your First App - PC Edition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter1/firstapp_mac/" class="md-nav__link">
        Your First App - Mac Edition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Chapter 2 - Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 2 - Authentication" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Chapter 2 - Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/backend/" class="md-nav__link">
        Authentication in the Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/enterprise/" class="md-nav__link">
        Enterprise Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/social/" class="md-nav__link">
        Social Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/debugging/" class="md-nav__link">
        Debugging Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/custom/" class="md-nav__link">
        Custom Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/authorization/" class="md-nav__link">
        Claims and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/realworld/" class="md-nav__link">
        Tokens in Real Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter2/bestpractices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Chapter 3 - Data Access and Offline Sync
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 3 - Data Access and Offline Sync" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Chapter 3 - Data Access and Offline Sync
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/dataconcepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/server/" class="md-nav__link">
        Implementing Table Controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/projection/" class="md-nav__link">
        Data Projection and Queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/client/" class="md-nav__link">
        The Mobile Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/relationships/" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter3/domainmgr/" class="md-nav__link">
        The Domain Manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Chapter 4 - Server Side Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 4 - Server Side Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Chapter 4 - Server Side Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/options/" class="md-nav__link">
        Options for Server Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/custom/" class="md-nav__link">
        Custom HTTP Endpoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/webjobs/" class="md-nav__link">
        WebJobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/functions/" class="md-nav__link">
        Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter4/recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Chapter 5 - Push Notifications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 5 - Push Notifications" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Chapter 5 - Push Notifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../android/" class="md-nav__link">
        Android Push
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          iOS Push
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        iOS Push
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#registering-with-apns" class="md-nav__link">
    Registering with APNS
  </a>
  
    <nav class="md-nav" aria-label="Registering with APNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-an-app-id-for-your-app" class="md-nav__link">
    Register an App ID for your app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-certificate-for-the-push-channel" class="md-nav__link">
    Create a certificate for the push channel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-notification-hubs" class="md-nav__link">
    Configure Notification Hubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-your-application" class="md-nav__link">
    Configure your application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-the-push-handler" class="md-nav__link">
    Code the push handler
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-with-azure-mobile-apps" class="md-nav__link">
    Registering with Azure Mobile Apps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-notifications" class="md-nav__link">
    Testing Notifications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-problems" class="md-nav__link">
    Common Problems
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        Windows Push
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../recipes/" class="md-nav__link">
        Push Recipes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Chapter 6 - Combining Web and Mobile Apps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 6 - Combining Web and Mobile Apps" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Chapter 6 - Combining Web and Mobile Apps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/mvc/" class="md-nav__link">
        MVC Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/jquery/" class="md-nav__link">
        jQuery Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/angular/" class="md-nav__link">
        Angular Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter6/react/" class="md-nav__link">
        React Applications
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Chapter 7 - Other Useful Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 7 - Other Useful Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Chapter 7 - Other Useful Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/services/" class="md-nav__link">
        Useful Azure Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/search/" class="md-nav__link">
        Azure Search
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter7/media/" class="md-nav__link">
        Media Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Chapter 8 - Developing An App
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 8 - Developing An App" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Chapter 8 - Developing An App
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/developing/" class="md-nav__link">
        The Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter8/testing/" class="md-nav__link">
        Testing your Application
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Chapter 9 - Going to Production
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Chapter 9 - Going to Production" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Chapter 9 - Going to Production
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/arm/" class="md-nav__link">
        Repeatable Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/appsvc/" class="md-nav__link">
        Safe Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter9/monitoring/" class="md-nav__link">
        Monitoring and Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../xamarin_tips/" class="md-nav__link">
        Xamarin Forms Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../android_appendix/" class="md-nav__link">
        Android Developer Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../vs_extensions/" class="md-nav__link">
        Visual Studio Extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        Credits
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#registering-with-apns" class="md-nav__link">
    Registering with APNS
  </a>
  
    <nav class="md-nav" aria-label="Registering with APNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-an-app-id-for-your-app" class="md-nav__link">
    Register an App ID for your app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-certificate-for-the-push-channel" class="md-nav__link">
    Create a certificate for the push channel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-notification-hubs" class="md-nav__link">
    Configure Notification Hubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-your-application" class="md-nav__link">
    Configure your application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-the-push-handler" class="md-nav__link">
    Code the push handler
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-with-azure-mobile-apps" class="md-nav__link">
    Registering with Azure Mobile Apps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-notifications" class="md-nav__link">
    Testing Notifications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-problems" class="md-nav__link">
    Common Problems
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter5/ios.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>iOS Push</h1>

<p>Push notifications for Apple devices is handled by <em>Apple Push Notification Service</em> or APNS.  APNS is certificate based, rather than secret based as is the case with FCM.  You will find that there are two certificates - a test certificate that is used for test devices, and a production certificate that is used for production devices.  You can use a common certificate for both (a so-called Universal Certificate).  However, you must ensure that you use the appropriate endpoints - test or production.</p>
<p>It is imperitive that you use a Mac for this configuration.  You will be using Apple native tools to generate certificates and the process of configuring the APNS gateway is made easier by using XCode tools.  You can do certain things on a PC (like editing the plist files appropriately), but you will end up spending a significant amount of time on the Mac.  As a result, I'm going to do this entire section on a Mac.</p>
<p>If you have not done so already, read through the <a href="../android/">Android Push</a> section to get all the code for the shared project - it won't be repeated in this section.</p>
<h2 id="registering-with-apns">Registering with APNS<a class="headerlink" href="#registering-with-apns" title="Permanent link">&para;</a></h2>
<p>Registering with APNS is a multi-step process:</p>
<ol>
<li>Register an App ID for your app, and select Push Notifications as a capability.</li>
<li>Create an appropriate certificate for the push channel (either a Development or Distribution certificate).</li>
<li>Configure Notification Hubs to use APNS.</li>
<li>Configure your application to support Push Notifications.</li>
<li>Add code for handling push notifications to your app.</li>
</ol>
<p>Let's cover each one in turn:</p>
<h3 id="register-an-app-id-for-your-app">Register an App ID for your app<a class="headerlink" href="#register-an-app-id-for-your-app" title="Permanent link">&para;</a></h3>
<p>Once you get to adding push notifications to your application, you are going to need that full developers license from Apple.  You need to work with real devices and that means you need code signing certificates on your mac.  If you have not spent the cash for the Apple Developers program, then you will probably find you need to at this point.</p>
<p>Registering an App ID is handled on the <a href="http://developer.apple.com/account">Apple Developer Portal</a>.  Apple does a good job of <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingProfiles/MaintainingProfiles.html#//apple_ref/doc/uid/TP40012582-CH30-SW991">documenting the process</a>, so these instructions are duplicative of the instructions that Apple provides.</p>
<ol>
<li>Go to the <a href="http://developer.apple.com/account">Apple Developer Portal</a> and log in with your Apple developer ID.</li>
<li>In the left-hand menu, click <strong>Certificates, IDs &amp; Profiles</strong>.</li>
<li>In the left-hand menu, <strong>Identifiers</strong>, click <strong>App IDs</strong>.</li>
<li>Click the <strong>+</strong> button in the top right corner.</li>
<li>
<p>Fill in the form:</p>
<ul>
<li>The App ID Description is not used and can be set to anything (subject to validation rules)</li>
<li>Choose an <strong>Explicit App ID</strong> for this app.</li>
<li>
<p>Enter the App ID suffix according to the rules.  I used <code>com.shellmonger.tasklist</code>.</p>
<p><img alt="" src="../img/push-ios-1.PNG" /></p>
</li>
<li>
<p>Select <strong>Push Notifications</strong> in the <strong>App Services</strong> section.</p>
<p><img alt="" src="../img/push-ios-2.PNG" /></p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Continue</strong> when the form is complete.</p>
</li>
<li>Make a note of the <strong>Identifier</strong> in the next screen, then click <strong>Register</strong>.</li>
<li>Click <strong>Done</strong>.</li>
</ol>
<p>Note that the Push Notifications capability will be listed as <em>Configurable</em> until you create a certificate that is used for push notifications.  Once that happens, the capability will be listed as <em>Enabled</em>.</p>
<h3 id="create-a-certificate-for-the-push-channel">Create a certificate for the push channel<a class="headerlink" href="#create-a-certificate-for-the-push-channel" title="Permanent link">&para;</a></h3>
<p>I mentioned earlier that APNS is certificate based.  That means that you need to generate an SSL certificate to fully configure push notifications:</p>
<ol>
<li>Staying in <strong>Certificates, Identifiers &amp; Profiles</strong>, click <strong>All</strong> under the <strong>Certificates</strong> heading in the left hand menu.</li>
<li>Click on the <strong>+</strong> button in the top right corner.</li>
<li>
<p>Select the <strong>Apple Push Notification service SSL (Sandbox &amp; Production)</strong></p>
<p><img alt="" src="../img/push-ios-3.PNG" /></p>
</li>
<li>
<p>Click <strong>Continue</strong>.</p>
</li>
<li>Select the App ID you just created from the list, then click <strong>Continue</strong>.</li>
<li>
<p>Follow the on-screen instructions for creating a Certificate Signing Request (CSR).</p>
<p><img alt="" src="../img/push-ios-4.PNG" /></p>
</li>
<li>
<p>Once you have generated the CSR, click <strong>Continue</strong> in the browser.</p>
</li>
<li>Select the CSR you just generated using the <strong>Choose File</strong> button, then click <strong>Continue</strong>.</li>
<li>Click <strong>Download</strong> to download the resulting certificate.</li>
<li>Click <strong>Done</strong> when the download is complete.</li>
<li>Find your downloaded certificate and double-click on it to import it into Keychain Access</li>
</ol>
<p>Your certificate will also appear in the <strong>Certificates</strong> &gt; <strong>All</strong> list within the Apple Developer console.</p>
<h3 id="configure-notification-hubs">Configure Notification Hubs<a class="headerlink" href="#configure-notification-hubs" title="Permanent link">&para;</a></h3>
<p>Notification Hubs requires you to upload the certificate as a .p12 (PKCS#12) file.  To generate this file:</p>
<ol>
<li>Open Keychain Access.</li>
<li>Select <strong>My Certificates</strong> from the left hand menu</li>
<li>Look for the certificate you just generated, and expand it to show the private key.</li>
<li>Right-click the private key and select <strong>Export...</strong>.</li>
<li>Select <strong>Personal Information Exchange (.p12)</strong> as the type and give it a name and location.</li>
<li>Click <strong>Save</strong>.</li>
<li>Enter a password (twice) to protect the certificate.</li>
<li>Click <strong>OK</strong>.</li>
</ol>
<p>Upload the certificate to Azure:</p>
<ol>
<li>Open and log into the <a href="https;//portal.azure.com/">Azure portal</a>.</li>
<li>Select <strong>Notification Hubs</strong>, then the notification hub that is connected to your mobile backend.</li>
<li>Click <strong>Push Notification Services</strong>, then select <strong>Apple (APNS)</strong>.</li>
<li>Click <strong>+ Upload Certificate</strong>.</li>
<li>
<p>Fill in the form:</p>
<ul>
<li>Select the .p12 file you just created.</li>
<li>Enter the password that you entered to secure the .p12 file.</li>
<li>Select <strong>Sandbox</strong> (probably) or <strong>Production</strong> as appropriate.</li>
</ul>
<p><img alt="" src="../img/push-ios-5.PNG" /></p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
<p>It's important to figure out whether you are operating in the <em>Sandbox</em> (Development) or <em>Production</em> mode.  During development, it's likely that your device will be registered on the Apple Developer console and you will be operating in the sandbox.  Any device not listed with the developer console is considered "production".  You must update the certificate to a production certificate and specify the production mode when you release your app.</p>
<p>Apple APNS provides two endpoints for pushing notifications.  If you use the wrong one, then APNS will return an error code.  This will cause Notification Hubs to delete the registration and your push will fail.</p>
<h3 id="configure-your-application">Configure your application<a class="headerlink" href="#configure-your-application" title="Permanent link">&para;</a></h3>
<p>Before we start with code, you will want a <em>Provisioning Profile</em>.  This small file is key to being able to use push notifications on your device.  You <strong>MUST</strong> have a real device at this point.  The easiest way for this to happen is to plug the iPhone or iPad that you want to use into your development system.  Once your device is recognized by iTunes, close iTunes down and start XCode.</p>
<p>First, locate the Device ID for your iDevice.  This can be found by opening <strong>Window</strong> -&gt; <strong>Devices</strong>.  Click on your iDevice in the left hand bar and copy the Identifier field.  There are several other ways of finding the device ID.  Refer to the <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingProfiles/MaintainingProfiles.html#//apple_ref/doc/uid/TP40012582-CH30-SW10">Apple documentation</a> for the other ways.</p>
<p>Once you have the Device ID, you can register the device as a development device.  Sign into the <a href="http://developer.apple.com/account">Apple Developer Portal</a>, then:</p>
<ol>
<li>Under <strong>Devices</strong>, click <strong>All</strong>.</li>
<li>Click the <strong>+</strong> button in the upper-right corner.</li>
<li>Select <strong>Register Device</strong>.</li>
<li>Enter a device name and the device ID you found earlier.</li>
<li>Click <strong>Continue</strong>.</li>
<li>Click <strong>Register</strong>.</li>
<li>Click <strong>Done</strong>.</li>
</ol>
<p>Now, create a Provisioning Profile:</p>
<ol>
<li>Under <strong>Provisioning Profiles</strong>, click <strong>All</strong>.</li>
<li>Click the <strong>+</strong> button in the upper-right corner.</li>
<li>Select <strong>iOS App Development</strong>, then click <strong>Continue</strong>.</li>
<li>Select the App ID you created earlier from the dropdown, then click <strong>Continue</strong>.</li>
<li>Select the certificates you want to include, then click <strong>Continue</strong>.  If you are unsure, include them all.</li>
<li>Select the device(s) you want to use, then click <strong>Continue</strong>.</li>
<li>Enter a Profile name, then click <strong>Continue</strong>.</li>
<li>You can (and should) download your provisioning profile to your local machine.</li>
<li>Click <strong>Done</strong>.</li>
</ol>
<p>For more information on creating a Provisioning Profile, see the <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingProfiles/MaintainingProfiles.html#//apple_ref/doc/uid/TP40012582-CH30-SW10">Apple documentation</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Download your Provisioning Profile to XCode</p>
<p>You can also download your provisioning profile within XCode for later use.  Visual Studio for Mac will be able to more easily detect it.  Open XCode, then open <strong>XCode</strong> &gt; <strong>Preferences</strong>.  Click <strong>Accounts</strong>, then your account.  Click your Agent entry in the right hand panel, then click <strong>View Details</strong>.  Finally, click <strong>Download All Profiles</strong>.  Once the download is complete, you can close the windows and return to Visual Studio.</p>
</div>
<p>Next, configure the iOS project for push notifications.  Start by loading your project in Visual Studio for Mac.</p>
<ol>
<li>Expand the <strong>TaskList.iOS</strong> project and open the <code>Info.plist</code> file.</li>
<li>
<p>In the <strong>Identity</strong> section, fill in the <strong>Bundle Identifier</strong>.  It must match the App ID Suffix that you set earlier.</p>
<p><img alt="" src="../img/push-ios-6.PNG" /></p>
</li>
<li>
<p>Scroll down until you see <strong>Background Modes</strong>.  Check the <strong>Enable Background Modes</strong> checkbox.</p>
<div class="admonition tip">
<p class="admonition-title">Adding an Account</p>
<p>Visual Studio for Mac uses fastlane for account authentication.  You will be walked through the process of adding an account the first time, and prompted to select an account thereafter.  Note that fastlane does not work when your Apple ID has 2-factor authentication enabled.  <a href="http://osxdaily.com/2016/08/17/disable-two-factor-authentication-apple-id/">Turn 2FA off</a> before you try to add an account.</p>
</div>
</li>
<li>
<p>Check the <strong>Remote notifications</strong> checkbox.</p>
<p><img alt="" src="../img/push-ios-7.PNG" /></p>
</li>
<li>
<p>Save and close the <code>Info.plist</code> file.</p>
</li>
<li>Right-click on the <strong>TaskList.iOS</strong> project, then select <strong>Options</strong>.</li>
<li>Click <strong>iOS Bundle Signing</strong> in the left hand menu.</li>
<li>Ensure the Platform is set to <strong>iPhone</strong> and not <em>iPhoneSimulator</em>.</li>
<li>Select your Signing Identity and Provisioning Profile.</li>
<li>Click <strong>OK</strong>.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Provisioning Profiles are frustrating</p>
<p>If you find yourself going round and round in circles on getting the signing certificate and provisioning profile right, you are not alone.  This is possibly one of the most frustrating pieces of iOS development.  See this <a href="https://forums.xamarin.com/discussion/13497">Xamarin Forums post</a> for a good list of details.</p>
</div>
<h3 id="code-the-push-handler">Code the push handler<a class="headerlink" href="#code-the-push-handler" title="Permanent link">&para;</a></h3>
<p>The push handler is coded in the <code>AppDelegate.cs</code> file.  Unlike other platforms (like Android), you don't have to write code to define the push handler.  It's always in the same place.  Add the following code to the <code>AppDelegate.cs</code> file:</p>
<pre><code class="language-csharp">    public static NSData PushDeviceToken { get; private set; } = null;

    public override bool FinishedLaunching(UIApplication app, NSDictionary options)
    {
        Microsoft.WindowsAzure.MobileServices.CurrentPlatform.Init();

        global::Xamarin.Forms.Forms.Init();
        LoadApplication(new App());

        if (UIDevice.CurrentDevice.CheckSystemVersion(8, 0))
        {
            var pushSettings = UIUserNotificationSettings.GetSettingsForTypes(
                UIUserNotificationType.Alert | UIUserNotificationType.Badge | UIUserNotificationType.Sound,
                new NSSet());
            UIApplication.SharedApplication.RegisterUserNotificationSettings(pushSettings);
            UIApplication.SharedApplication.RegisterForRemoteNotifications();
        }

        return base.FinishedLaunching(app, options);
    }

    /// &lt;summary&gt;
    /// Called when the push notification system is registered
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;application&quot;&gt;Application.&lt;/param&gt;
    /// &lt;param name=&quot;deviceToken&quot;&gt;Device token.&lt;/param&gt;
    public override void RegisteredForRemoteNotifications(UIApplication application, NSData deviceToken)
    {
        AppDelegate.PushDeviceToken = deviceToken;
    }

    public override void DidReceiveRemoteNotification(UIApplication application,
        NSDictionary userInfo, Action&lt;UIBackgroundFetchResult&gt; completionHandler)
    {
        NSDictionary aps = userInfo.ObjectForKey(new NSString(&quot;aps&quot;)) as NSDictionary;

        // The aps is a dictionary with the template values in it
        // You can adjust this section to do whatever you need to with the push notification

        string alert = string.Empty;
        if (aps.ContainsKey(new NSString(&quot;alert&quot;)))
            alert = (aps[new NSString(&quot;alert&quot;)] as NSString).ToString();

        //show alert
        if (!string.IsNullOrEmpty(alert))
        {
            UIAlertView avAlert = new UIAlertView(&quot;Notification&quot;, alert, null, &quot;OK&quot;, null);
            avAlert.Show();
        }
    }
</code></pre>
<p>The <code>NSDictionary</code>, <code>NSData</code>, and <code>NSString</code> classes are part of the iOS programming model and do exactly what you would expect them to do.  The <code>UIAlertView</code> class provides a standard alert.  We need to add a little bit of code to the <code>FinishedLaunching()</code> method to send the registration request to APNS.  When the response is received, the <code>RegisteredForRemoteNotifications()</code> method is called.  Finally, the <code>DidReceiveRemoteNotification()</code> method is called whenever a remote push notification is received.</p>
<div class="admonition tip">
<p class="admonition-title">Call common code for push notifications</p>
<p>One of the great things about Xamarin Forms is that it is cross-platform.  However, that all breaks down when you move to push notifications.  One of the things you can do is to use the push handler to generate a model and then pass that model to a method in your PCL project.  This allows you to express the differences clearly and yet still do the majority of the logic in a cross-platform manner.</p>
</div>
<h2 id="registering-with-azure-mobile-apps">Registering with Azure Mobile Apps<a class="headerlink" href="#registering-with-azure-mobile-apps" title="Permanent link">&para;</a></h2>
<p>As with Android, I recommend using a <code>HttpClient</code> for registering with Notification Hubs via the Azure Mobile Apps Push handler.  Here is the code that does basically the same thing as the Android version from the <code>Services\iOSPlatformProvider.cs</code> file:</p>
<pre><code class="language-csharp">    public async Task RegisterForPushNotifications(MobileServiceClient client)
    {
        if (AppDelegate.PushDeviceToken != null)
        {
            try
            {
                var registrationId = AppDelegate.PushDeviceToken.Description
                    .Trim('&lt;', '&gt;').Replace(&quot; &quot;, string.Empty).ToUpperInvariant();
                var installation = new DeviceInstallation
                {
                    InstallationId = client.InstallationId,
                    Platform = &quot;apns&quot;,
                    PushChannel = registrationId
                };
                // Set up tags to request
                installation.Tags.Add(&quot;topic:Sports&quot;);
                // Set up templates to request
                PushTemplate genericTemplate = new PushTemplate
                {
                    Body = @&quot;{&quot;&quot;aps&quot;&quot;:{&quot;&quot;alert&quot;&quot;:&quot;&quot;$(messageParam)&quot;&quot;}}&quot;
                };
                installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);

                // Register with NH
                var response = await client.InvokeApiAsync&lt;DeviceInstallation, DeviceInstallation&gt;(
                    $&quot;/push/installations/{client.InstallationId}&quot;,
                    installation,
                    HttpMethod.Put,
                    new Dictionary&lt;string, string&gt;());
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.Fail($&quot;[iOSPlatformProvider]: Could not register with NH: {ex.Message}&quot;);
            }
        }
    }
</code></pre>
<p>In this case, we don't have a service class to deal with - the iOS AppDelegate does all the work for us.  The registration Id is stored in the AppDelegate once registered, but needs to be decoded (which is relatively simple).  Similar to the Android version, we make the template we are using match what we are expecting within our push handler.</p>
<div class="admonition tip">
<p class="admonition-title">Receiving Notifications in the background</p>
<p>If you want your app to be notified when a notification is received when your app is in the background, you need to set the Background Fetch capability and your payload should include the key <code>content-available</code> with a value of 1 (true).  You can add this to the Body of the template in the above sample.  iOS will wake up the app and you will have 30 seconds to fetch any information you might need to update.  Check <a href="https://developer.xamarin.com/guides/ios/application_fundamentals/backgrounding/part_3_ios_backgrounding_techniques/updating_an_application_in_the_background/">the documentation</a> for more details.</p>
</div>
<h2 id="testing-notifications">Testing Notifications<a class="headerlink" href="#testing-notifications" title="Permanent link">&para;</a></h2>
<p>Our final step is to test the whole process.  As with Android, there are two tests we need to perform.  The first is to ensure that a registration happens when we expect it to.  In the case of our app, that happens immediately after the authentication.  There is no Notifications Hub registration monitor in Visual Studio for Mac, so we have to get that information an alternate way, by querying the hub registration endpoint.  I've written [a script] for this purpose.  To install:</p>
<ul>
<li>Install <a href="https://nodejs.org/en/download/">NodeJS</a>.</li>
<li>Go to the <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/tree/main/tools">tools</a> directory on the books GitHub repository.</li>
<li>Run <code>npm install</code>.</li>
</ul>
<p>To use, you will need the endpoint for your notification hub namespace.</p>
<ul>
<li>Log onto the <a href="https;//portal.azure.com/">Azure portal</a>.</li>
<li>Open your Notification Hub namespace.</li>
<li>Click <strong>Access Policies</strong>.</li>
<li>Copy the connection string of the <code>RootManagedSharedAccessKey</code> (which is probably the only policy you have).</li>
</ul>
<p>You can now use the program using:</p>
<pre><code class="language-text">node get_nh_registrations.js -c '&lt;your connection string&gt;' -h &lt;your hub name&gt;
</code></pre>
<p>You will need to put the connection string in quotes generally.  For example:</p>
<pre><code class="language-text">node .\get_nh_registrations.js -c 'Endpoint=sb://zumobook-ns.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=
****c9VoZHtxSGliSIhH5EEuar1B/jsrgTQTHOTA=' -h zumobook-hub
</code></pre>
<p>The output will look something like the following:</p>
<pre><code class="language-text">Type:         APNS (Template)
Id:           219869525209729025-4738338868778066550-1
Device Token: 681F6BB012C62A61AA2185A676B23907A5FEFE9268283DD226B08B5F0336A552
Tag:          topic:Sports
Tag:          _UserId:a9650e1c4d3268ec912f4d9ca6d1d933
Tag:          photoadrian@outlook.com
Tag:          $InstallationId:{d7323fe4-64bb-4d99-a6cc-e7690032350f}
Expires:      9999-12-31T23:59:59.9999999Z
</code></pre>
<p>Note that this script does not deal with "continuation tokens", so it can only return the first page of information.  This is generally suitable for testing purposes.</p>
<p>We can also send a test message for push notifications.  This can be done via the Azure Portal.</p>
<ol>
<li>Log onto the <a href="https;//portal.azure.com/">Azure portal</a>.</li>
<li>Find the Hub resource for your connected Notification Hub and open it.</li>
<li>Click <strong>Test Send</strong>.</li>
<li>Select <strong>Apple</strong> as the Platform, then click on <strong>Send</strong>.</li>
</ol>
<p><img alt="" src="../img/push-ios-9.PNG" /></p>
<p>Your device should also receive the push notification and display an alert.  You can also do a test send to an explicit tag.  This can narrow the test send to just one device if necessary.  To send to a specific device, you need to know the installation ID of the registration.</p>
<h2 id="common-problems">Common Problems<a class="headerlink" href="#common-problems" title="Permanent link">&para;</a></h2>
<p>As you might expect, there is plenty to go wrong here.  The majority of the issues come down to the fact that there are two endpoints on APNS - a Sandbox (or Developer) endpoint and a Production endpoint.  If you are using the wrong endpoint, the notification hub will receive an error.  If the notification hub receives an error from the APNS endpoint, it will remove the registration causing the error.  This manifests itself in two ways.  Firstly, your device will not receive the push notification.  Secondly, the registration will be removed from the list of valid registrations, causing you to think that the device has not been registered.</p>
<p>This has not been made easy by the fact that Apple has combined the certificates needed to push into a single certificate for both Sandbox and Production use cases.  To correct this issue, ensure the notifiction hub is set up with the appropriate endpoint - Sandbox or Production.</p>
<p>Next you can move onto <a href="../windows/">Windows Push</a> or skip to the <a href="../recipes/">Recipes Section</a>.</p>
<!-- Images -->
<!-- Links -->

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../android/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Android Push" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Android Push
            </div>
          </div>
        </a>
      
      
        
        <a href="../windows/" class="md-footer__link md-footer__link--next" aria-label="Next: Windows Push" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Windows Push
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2020 Adrian Hall
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/adrianhall" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/FizzyInTheHall" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
  </body>
</html>