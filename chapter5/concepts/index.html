
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://adrianhall.github.io/develop-mobile-apps-with-csharp-and-azure/chapter5/concepts/">
      
      
        <meta name="author" content="Adrian Hall">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.2.0">
    
    
      
        <title>Concepts - Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-e17eeafcbc.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-892b79c5c5.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/vs.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="red" data-md-color-accent="deep-purple">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Chapter 5 - Push Notifications
                </span>
              
            
            Concepts
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Develop Cloud Connected Mobile Apps with Xamarin and Microsoft Azure
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Chapter 1 - Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Chapter 1 - Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_pc/" title="Your First App - PC Edition" class="md-nav__link">
      Your First App - PC Edition
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter1/firstapp_mac/" title="Your First App - Mac Edition" class="md-nav__link">
      Your First App - Mac Edition
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Chapter 2 - Authentication
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Chapter 2 - Authentication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/authconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/backend/" title="Authentication in the Backend" class="md-nav__link">
      Authentication in the Backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/enterprise/" title="Enterprise Authentication" class="md-nav__link">
      Enterprise Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/social/" title="Social Authentication" class="md-nav__link">
      Social Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/debugging/" title="Debugging Authentication" class="md-nav__link">
      Debugging Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/custom/" title="Custom Authentication" class="md-nav__link">
      Custom Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/authorization/" title="Claims and Authorization" class="md-nav__link">
      Claims and Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/realworld/" title="Tokens in Real Apps" class="md-nav__link">
      Tokens in Real Apps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter2/bestpractices/" title="Best Practices" class="md-nav__link">
      Best Practices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Chapter 3 - Data Access and Offline Sync
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Chapter 3 - Data Access and Offline Sync
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/dataconcepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/server/" title="Implementing Table Controllers" class="md-nav__link">
      Implementing Table Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/projection/" title="Data Projection and Queries" class="md-nav__link">
      Data Projection and Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/client/" title="The Mobile Client" class="md-nav__link">
      The Mobile Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter3/domainmgr/" title="The Domain Manager" class="md-nav__link">
      The Domain Manager
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Chapter 4 - Server Side Code
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Chapter 4 - Server Side Code
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/options/" title="Options for Server Code" class="md-nav__link">
      Options for Server Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/custom/" title="Custom HTTP Endpoints" class="md-nav__link">
      Custom HTTP Endpoints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/webjobs/" title="WebJobs" class="md-nav__link">
      WebJobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter4/recipes/" title="Recipes" class="md-nav__link">
      Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Chapter 5 - Push Notifications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Chapter 5 - Push Notifications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Concepts" class="md-nav__link md-nav__link--active">
      Concepts
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../android/" title="Android Push" class="md-nav__link">
      Android Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ios/" title="iOS Push" class="md-nav__link">
      iOS Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../windows/" title="Windows Push" class="md-nav__link">
      Windows Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recipes/" title="Push Recipes" class="md-nav__link">
      Push Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Chapter 6 - Combining Web and Mobile Apps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Chapter 6 - Combining Web and Mobile Apps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/mvc/" title="MVC Applications" class="md-nav__link">
      MVC Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/jquery/" title="jQuery Applications" class="md-nav__link">
      jQuery Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/angular/" title="Angular Applications" class="md-nav__link">
      Angular Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter6/react/" title="React Applications" class="md-nav__link">
      React Applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Chapter 7 - Other Useful Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Chapter 7 - Other Useful Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/services/" title="Useful Azure Services" class="md-nav__link">
      Useful Azure Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/search/" title="Azure Search" class="md-nav__link">
      Azure Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/media/" title="Media Services" class="md-nav__link">
      Media Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter7/realtime/" title="Real-time Notifications" class="md-nav__link">
      Real-time Notifications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Chapter 8 - Developing An App
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Chapter 8 - Developing An App
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/developing/" title="The Development Environment" class="md-nav__link">
      The Development Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter8/testing/" title="Testing your Application" class="md-nav__link">
      Testing your Application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Chapter 9 - Going to Production
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Chapter 9 - Going to Production
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/arm/" title="Repeatable Deployments" class="md-nav__link">
      Repeatable Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/appsvc/" title="Safe Deployments" class="md-nav__link">
      Safe Deployments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter9/troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../xamarin_tips/" title="Xamarin Forms Tips" class="md-nav__link">
      Xamarin Forms Tips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../android_appendix/" title="Android Developer Notes" class="md-nav__link">
      Android Developer Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../vs_extensions/" title="Visual Studio Extensions" class="md-nav__link">
      Visual Studio Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../credits/" title="Credits" class="md-nav__link">
      Credits
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-push-notifications-works" title="How Push Notifications Works" class="md-nav__link">
    How Push Notifications Works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introducing-notification-hubs" title="Introducing Notification Hubs" class="md-nav__link">
    Introducing Notification Hubs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tags" title="Tags" class="md-nav__link">
    Tags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templates" title="Templates" class="md-nav__link">
    Templates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-notification-hubs" title="Configuring Notification Hubs" class="md-nav__link">
    Configuring Notification Hubs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-push-registration" title="Configuring Push Registration" class="md-nav__link">
    Configuring Push Registration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-your-mobile-client" title="Registering Your Mobile Client" class="md-nav__link">
    Registering Your Mobile Client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" title="Next Steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
                 <a href="https://github.com/adrianhall/develop-mobile-apps-with-csharp-and-azure/edit/master/docs/chapter5/concepts.md" title="Edit this page" class="md-icon md-content__edit">edit</a>
               
              
                
                  <h1>Concepts</h1>
                
                <p>Thus far, we've looked at options for communicating with the backend while the client is running.  When the user changes apps, the client is suspended or placed on a low priority background thread.  No user interaction is possible during this time.</p>
<p>Most developers have a need to communicate interesting things to the user and this can only happen if the app is running.  Fortunately, the major mobile platform providers have implemented some form of push notifications which are delivered to the app when it isn't running.</p>
<p>Push notifications are messages that are sent to your mobile client whether the app is running or not.  The mobile device will wake up your app to deliver the message.  You have probably seen many examples of push notifications in your daily mobile phone usage.  There are several uses, but they fall into two broad areas.  Marketing messages are sent to inform the user of the app of something.  Perhaps it's a new version, or a specific promotion for your favorite store.  Silent notifications are sent to inform the app that something important has happened.  For example, you may want to send a message when a data element has been updated in a table.  Silent notifications are generally not to be seen by the user.</p>
<p>Delivery of these messages comes with some significant penalties.  You cannot guarantee the delivery of a message.  The user of the device decides whether to accept messages or not.  You cannot guarantee a delivery time, even though most messages are delivered within a couple of minutes.  Finally, there is no built in acknowledgement of the message.  You have to do something extra in code to ensure the delivery happens.</p>
<h2 id="how-push-notifications-works">How Push Notifications Works<a class="headerlink" href="#how-push-notifications-works" title="Permanent link">&para;</a></h2>
<p>Each platform provider provides their own push notification service.  For example, iOS uses <em>Apple Push Notification Service (APNS)</em>.  Google uses <em>Firebase Communications Manager (FCM)</em>.  This used to be called Google Communications Manager or GCM.  It's the same service; just rebranded.  Newer versions of Windows (including Universal Windows) use <em>Windows Notification Service (WNS)</em> whereas older versions of Windows Phone used <em>Microsoft Platform Notification
Service (MPNS)</em>.  There are other push notification services, for example, for FireOS (run by Amazon) and China (run by Baidu).</p>
<p>In all cases, the process is the same:</p>
<p><img alt="" src="../img/push-architecture.PNG" /></p>
<p>The mobile device initiates the process, registering with the Platform Notification Service (PNS).  It will receive a <strong>Registration ID</strong> in return. The registration ID is specific to an app running on a specific device. Once you have the registration ID, you will pass that registration ID to your backend.  The backend will use the registration ID when communicating with the PNS to send your app messages.</p>
<p>This is where complexity rears its ugly head.  Without an intervening service, the backend will need to do the following:</p>
<ul>
<li>Store the registration ID and PNS in a database for later reference.</li>
<li>Lookup the list of registration IDs on a per-PNS basis and send a provided message in batches.</li>
<li>Handle retry, incremental back-off, throttling and tracking for each message.</li>
<li>Deal with registration failure and maintenance of the database.</li>
</ul>
<p>This is just the start of the functionality.  In general, marketeers will want tracking of the messages (such as how many were opened or acted on, what demographics were the opened messages, etc.) and they will want to push to only a subset of users, targetted by opt-in lists or other demographic information.</p>
<h2 id="introducing-notification-hubs">Introducing Notification Hubs<a class="headerlink" href="#introducing-notification-hubs" title="Permanent link">&para;</a></h2>
<p>Developing a system for pushing notifications to devices is a significant undertaking.  I would not recommend anyone undertake such a service for their app.  Fortunately, there are a number of services that can do this for you.  Azure's entry into this space is <a href="https://azure.com/en-us/services/notification-hubs/">Azure Notification Hubs</a>.  Notification Hubs (or NH as we will call it) handles all the registration and bulk sending logic to allow you to send a single message to multiple recipients without having to
worry about what platform they are on.  In addition, NH has support for tagging individual device registrations with information about the user, groups, or opt-in lists.</p>
<p>Azure Mobile Apps has direct support for Notification Hubs within the client SDK and Azure App Service has a registration service built right in for NH, allowing you to easily integrate your mobile app with the facilities that NH provides.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You do not have to run Azure Mobile Apps or Azure App Service to use Notification Hubs.  You do need to have a registration service somewhere.  However, Notification Hubs is a standalone service.  Do not use Notification Hubs as the registration service - you will need to distribute the key with your service, and that opens up security concerns.</p>
</div>
<p>Notification Hubs has two features that are important in mobile push scenarios - tags and templates.  while you will see these two features a lot in this chapter, we will also use other features of Notification Hubs, such as Scheduled Push, Geofenced Push and Analytics.</p>
<h3 id="tags">Tags<a class="headerlink" href="#tags" title="Permanent link">&para;</a></h3>
<p>When a device registers itself with Notification Hubs (via the registration endpoint), you can specify a number of tags that are associated with the device.  The tag allows you to segment the devices and push a message to only a portion of the devices.  Technically, a tag is a string.  The string can be up to 120 characters long, but has a restricted character set (alphanumeric plus a few special characters).</p>
<p>You can use tags to allow the user to register interest in a topic, or register on their behalf based on just about anything you want.  If you want to push to a department or users in a specific location, you can automatically register for those tags within the registration service.  You can also use tags to do "user tagging" - allowing you to push to a user ID or email address instead of a device ID.</p>
<p>When sending a push notification, you can broadcast a message to everyone, but it's generally better to send to a tag.  You can also combine tags with boolean operations.  For example, you might want to push a Marketing message to all sales people in Washington with <code>(state:Washington &amp;&amp; dept:Sales)</code>.  Tag expressions like this are limited in the number of tags allowed.</p>
<h3 id="templates">Templates<a class="headerlink" href="#templates" title="Permanent link">&para;</a></h3>
<p>There are multiple plaform notification systems and each one wants a message sent to them in a specific format.  APNS and FCM require a JSON payload (each of which is different), while WNS requires an XML payload.  Effectively, this makes the backend of your app responsible for a part of the presentation layer, which is something that has been avoided thus far.  In addition, you might want to localize the message for your audience and potentially use string replacement to customize the message for the recipient.</p>
<p>Templates provide a way to send cross-platform notifications and customize the message for each recipient.  You can use locale files to insert locale-specific messages into the template.</p>
<h2 id="configuring-notification-hubs">Configuring Notification Hubs<a class="headerlink" href="#configuring-notification-hubs" title="Permanent link">&para;</a></h2>
<p>Our first step is to configure our backend.  Thus far, we have implemented an Azure App Service with a SQL Azure database, and that is our starting point again.  To those resources, we will add the Notification Hub, which starts just like the addition of any other resource:</p>
<ul>
<li>Log into the <a href="https://portal.azure.com">Azure portal</a>.</li>
<li>Click on the <strong>+ NEW</strong> button in the top right corner (or the <strong>+ ADD</strong> button at the top of your resource group).</li>
<li>Select or search for <strong>Notification Hub</strong>.</li>
<li>Click on <strong>Create</strong>.</li>
</ul>
<p><img alt="" src="../img/push-create-2.PNG" /></p>
<ul>
<li>Enter the information required.  You will need to create both a notification hub and a namespace.  I generally add the <code>-ns</code> designation to a namespace.</li>
<li>Click on <strong>Create</strong>.</li>
</ul>
<p>Notification Hubs has three tiers which give you increasing numbers of pushes, plus additional features.  The <em>Free</em> tier provides just push services.  The <em>Basic</em> tier gives you the more pushes plus the opportunity to buy additional pushes. Telemetry, scheduled push and multi-tenancy are only provided in the <em>Standard</em> tier, which should be your choice for production workloads.</p>
<p>When considering architecture, you should use one Notification Hub per mobile backend.  Notification Hub namespaces are used for deployment grouping.  For example, you might want to give a different namespace to each tenant in a multi-tenant environment.</p>
<p>Once your notification hub has been created, you will see both the hub and the namespace listed in your resource group.  Note that we have not actually linked the notification hub to any platform notification services yet.  We will do that later.</p>
<h2 id="configuring-push-registration">Configuring Push Registration<a class="headerlink" href="#configuring-push-registration" title="Permanent link">&para;</a></h2>
<p>Push registration is generally handled by the mobile backend, and there is a feature of the App Service for this purpose.  Although it is possible, resist trying to get mobile clients to register with the notification hub directly.</p>
<ul>
<li>Log into the <a href="https://portal.azure.com">Azure portal</a>.</li>
<li>Select your mobile backend.</li>
<li>Click on <strong>Push</strong> (under the <strong>SETTINGS</strong> menu).</li>
<li>Click on <strong>Connect</strong>.</li>
<li>Select the notification hub you created earlier.</li>
<li>Wait for the notification hub to be connected (it takes approximately 10 seconds).</li>
</ul>
<p><img alt="" src="../img/push-create-3.PNG" /></p>
<p>You can now decide which tags are valid for this application.  The mobile client will request a list of tags.  The push registration service will use this information to register the appropriate tags with the notification hub.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The process is called push registration, but the entity that is created in notification hubs is called an <strong>Installation</strong>.</p>
</div>
<p>There are two types of tags.  Client requested tags may be requested by the mobile client during the registration process.  Automatically added tags are added by the mobile backend.  Let's take an example. My mobile backend is connected to Azure Active Directory.   I've configured my backend as follows:</p>
<p><img alt="" src="../img/push-create-4.PNG" /></p>
<p>Here, I have three client requested tags and an automatically generated tag that is only added when authenticated.  Let's suppose that the mobile client requested <code>[ topic:World topic:Sports ]</code> and the mobile client was authenticated as username <code>user@foo.com</code>.  With this configuration, the user would be registered for the following tags:</p>
<ul>
<li>topic:Sports</li>
<li>auto:user@foo.com</li>
</ul>
<p>The topic:Politics and topic:News tags would not be added because the user did not request them.  The topic:World tag would not be added because it is not in the whitelist of allowed client requested tags.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>There is no ability to request any tag (a wild-card) because it is a large security hole.  With a wild-card tag, you could request push notifications for a user or group to which you were not allowed.</p>
</div>
<p>The <code>$(provider.claim)</code> format is used in automatically added tags to add claims from the authenticated userinto the notification hub installation.  You can use any claim that is returned by the <code>/.auth/me</code> endpoint.  The standard identifiers are:</p>
<ul>
<li>$(<em>provider</em>.emailaddress)</li>
<li>$(<em>provider</em>.identityprovider)</li>
<li>$(<em>provider</em>.name)</li>
</ul>
<p>Replace <em>provider</em> with the provider name (facebook, google, microsoftaccount, twitter or aad).  The list of claims that are available is different for each provider and additional claims may be available.  It is possible to configure Azure AD to return groups, for example.  Check the output of the  <code>/.auth/me</code> endpoint to determine which claims are available.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The automatic claim tags are only included when authenticated with a supported authentication provider.  If you are using Custom Authentication, you must also use a custom WebAPI controller to do push registration if you wants claims based on your authentication.</p>
</div>
<p>A claim name can resolve to multiple claim types.  For example, <code>$(aad.name)</code> resolves to the following claims:</p>
<ul>
<li>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name</li>
<li>http://schemas.microsoft.com/ws/2008/06/identity/claims/name</li>
<li>name</li>
</ul>
<p>In this case, three tags may be created - one for each unique name.</p>
<div class="admonition warn">
<p class="admonition-title">Warn</p>
<p>App Service Push provides a default tag called _UserId.  This is currently badly formed based on the MD5 of the SID provided in the authentication token.  My recommendation is to not rely on or use the default tags that are provided.  Set up your own tags.</p>
</div>
<p>Once you have configure the tags, click on <strong>Save</strong> to save your work.</p>
<h2 id="registering-your-mobile-client">Registering Your Mobile Client<a class="headerlink" href="#registering-your-mobile-client" title="Permanent link">&para;</a></h2>
<p>After you have gained the requisite platform-specific registration ID, you need to pass this to the mobile backend.  The registration endpoint listens on <code>/push/installations/{guid}</code> where the GUID is a unique ID for the app on a specific mobile device.  The Azure Mobile Apps client generates this for you.  You must <strong>HTTP PUT</strong> a JSON <strong>Installation</strong> object to this URL.  A simple (empty) <strong>Installation</strong> object looks like this:</p>
<pre><code class="text">{
    &quot;installationId&quot;: &quot;{guid}&quot;,
    &quot;platform&quot;: &quot;gcm&quot;,
    &quot;pushChannel&quot;: &quot;{registrationid}&quot;
}
</code></pre>

<p>The minimal settings are the installationId, platform, and pushChannel.  The pushChannel field needs to be set to the registration ID of the platform.  The platform is set to the appropriate value for the platform you are using - gcm, apns or wns.   You can also add tags and template into this installation object.  Check out the <a href="../recipes/">recipes section</a> for details on requesting tags and templates.</p>
<p>There is a simple class for implementing an installation, which I place in <code>Abstractions\DeviceInstallation.cs</code> within the shared project:</p>
<pre><code class="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;

namespace TaskList.Abstractions
{
    public class DeviceInstallation
    {
        public DeviceInstallation()
        {
            Tags = new List&lt;string&gt;();
            Templates = new Dictionary&lt;string, PushTemplate&gt;();
        }

        [JsonProperty(PropertyName = &quot;installationId&quot;)]
        public string InstallationId { get; set; }

        [JsonProperty(PropertyName = &quot;platform&quot;)]
        public string Platform { get; set; }

        [JsonProperty(PropertyName = &quot;pushChannel&quot;)]
        public string PushChannel { get; set; }

        [JsonProperty(PropertyName = &quot;tags&quot;)]
        public List&lt;string&gt; Tags { get; set; }

        [JsonProperty(PropertyName = &quot;templates&quot;)]
        public Dictionary&lt;string, PushTemplate&gt; Templates { get; set; }
    }

    public class PushTemplate
    {
        public PushTemplate()
        {
            Tags = new List&lt;string&gt;();
        }

        [JsonProperty(PropertyName = &quot;body&quot;)]
        public string Body { get; set; }

        [JsonProperty(PropertyName = &quot;tags&quot;)]
        public List&lt;string&gt; Tags { get; set; }
    }
}
</code></pre>

<p>The <code>Installation</code> object is also available in the Notification Hubs SDK, but I find bringing in the entire Notification Hubs SDK just for this is a little overkill.  You can create a suitable installation and register with the <code>InvokeApiAsync&lt;T,U&gt;()</code> method:</p>
<pre><code class="csharp">    public async Task RegisterForPushNotifications(MobileServiceClient client)
    {
        if (GcmClient.IsRegistered(RootView))
        {
            try
            {
                var registrationId = GcmClient.GetRegistrationId(RootView);
                //var push = client.GetPush();
                //await push.RegisterAsync(registrationId);

                var installation = new DeviceInstallation
                {
                    InstallationId = client.InstallationId,
                    Platform = &quot;gcm&quot;,
                    PushChannel = registrationId
                };

                // Set up tags to request
                installation.Tags.Add(&quot;topic:Sports&quot;);

                // Set up templates to request
                PushTemplate genericTemplate = new PushTemplate
                {
                    Body = @&quot;{&quot;&quot;data&quot;&quot;:{&quot;&quot;message&quot;&quot;:&quot;&quot;$(messageParam)&quot;&quot;}}&quot;
                };
                installation.Templates.Add(&quot;genericTemplate&quot;, genericTemplate);

                // Register with NH
                var response = await client.InvokeApiAsync&lt;DeviceInstallation, DeviceInstallation&gt;(
                    $&quot;/push/installations/{client.InstallationId}&quot;,
                    installation,
                    HttpMethod.Put,
                    new Dictionary&lt;string, string&gt;());
            }
            catch (Exception ex)
            {
                Log.Error(&quot;DroidPlatformProvider&quot;, $&quot;Could not register with NH: {ex.Message}&quot;);
            }
        }
        else
        {
            Log.Error(&quot;DroidPlatformProvider&quot;, $&quot;Not registered with GCM&quot;);
        }
    }
</code></pre>

<div class="admonition info">
<p class="admonition-title">Where is that endpoint?</p>
<p>The <code>/push/installations</code> endpoint is part of App Service Push - a feature of the Azure App Service resource.  This exists on your <code>.azurewebsites.net</code> domain.  It is not part of Notification Hubs.</p>
</div>
<p>This is normally placed within the platform-specific provider since the details on how to get the registration ID and platform are different.  This version is for the Android edition as an example.  Using <code>InvokeApiAsync()</code> instead of relying on the in-built Azure Mobile Apps push registration methods gives you more control over the process of registration.</p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Each push notification system is different and requires different configuration in both the mobile client and backend registration system.  You can jump directly to a specific platform:</p>
<ul>
<li><a href="../android/">Android</a>.</li>
<li><a href="../ios/">iOS</a>.</li>
<li><a href="../windows/">Windows</a>.</li>
</ul>
<!-- Images -->

<!-- Links -->
              
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../chapter4/recipes/" title="Recipes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Recipes
              </span>
            </div>
          </a>
        
        
          <a href="../android/" title="Android Push" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Android Push
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Adrian Hall
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/adrianhall" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/FizzyInTheHall" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-30ac6a1727.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="../../js/highlight.pack.js"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-93366112-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>